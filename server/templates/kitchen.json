{
  "id": "a0b248342583",
  "name": "function-call-kitchen",
  "description": "Interactive cooking assistant with Gemini function calling and debug console",
  "stack": "react-only",
  "complexity": "STANDARD",
  "files": [
    {
      "path": ".env.local",
      "content": "GEMINI_API_KEY=PLACEHOLDER_API_KEY\n",
      "role": "COMPONENT",
      "language": "text",
      "size": 35,
      "order": 0
    },
    {
      "path": ".gitignore",
      "content": "# Logs\nlogs\n*.log\nnpm-debug.log*\nyarn-debug.log*\nyarn-error.log*\npnpm-debug.log*\nlerna-debug.log*\n\nnode_modules\ndist\ndist-ssr\n*.local\n\n# Editor directories and files\n.vscode/*\n!.vscode/extensions.json\n.idea\n.DS_Store\n*.suo\n*.ntvs*\n*.njsproj\n*.sln\n*.sw?\n",
      "role": "COMPONENT",
      "language": "text",
      "size": 253,
      "order": 1
    },
    {
      "path": "App.css",
      "content": "/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n:root {\n  --Neutral-5: #181a1b;\n  --Neutral-10: #1e2021;\n  --Neutral-15: #232729;\n  --Neutral-20: #2a2f31;\n  --Neutral-30: #404547;\n  --Neutral-40: #585d5f;\n  --Neutral-50: #707577;\n  --Neutral-60: #888d8f;\n  --Neutral-70: #a0a4a5;\n  --Neutral-80: #c0c3c4;\n  --Neutral-90: #e1e2e3;\n  --Blue-400: #80c1ff;\n  --Blue-500: #1f94ff;\n  --Blue-800: #0f3557;\n  --Green-500: #0d9c53;\n  --Red-400: #ff9c7a;\n  --Red-500: #ff4600;\n  --Red-800: #571a0f;\n  scrollbar-color: var(--Neutral-30) var(--Neutral-5);\n  scrollbar-width: thin;\n  --font-family: monospace;\n}\n\nbody {\n  font-family: var(--font-family);\n  background: white;\n  margin: 0;\n  padding: 0;\n}\n\n.material-symbols-outlined.filled {\n  font-variation-settings: \"FILL\" 1, \"wght\" 400, \"GRAD\" 0, \"opsz\" 24;\n}\n\n/* ============================================================================\n   100 Tools Kitchen App Styles\n   ============================================================================ */\n\n.app-container {\n  min-height: 100vh;\n  background: #fafafa;\n  padding-top: 20px;\n  padding-bottom: 60px;\n  position: relative;\n}\n\n/* Chef's checkered pattern down the sides of the page */\n.app-container::before,\n.app-container::after {\n  content: '';\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  width: 24px;\n  pointer-events: none;\n  z-index: 100;\n}\n\n.app-container::before {\n  left: 4px;\n  background: repeating-linear-gradient(\n    to bottom,\n    #000 0px, #000 12px,\n    #fff 12px, #fff 24px\n  ), repeating-linear-gradient(\n    to bottom,\n    #fff 0px, #fff 12px,\n    #000 12px, #000 24px\n  );\n  background-size: 12px 24px, 12px 24px;\n  background-position: 0 0, 12px 0;\n  background-repeat: repeat-y;\n}\n\n.app-container::after {\n  right: 4px;\n  background: repeating-linear-gradient(\n    to bottom,\n    #000 0px, #000 12px,\n    #fff 12px, #fff 24px\n  ), repeating-linear-gradient(\n    to bottom,\n    #fff 0px, #fff 12px,\n    #000 12px, #000 24px\n  );\n  background-size: 12px 24px, 12px 24px;\n  background-position: 0 0, 12px 0;\n  background-repeat: repeat-y;\n}\n\n/* Hide checkered pattern on narrow screens */\n@media (max-width: 1000px) {\n  .app-container::before,\n  .app-container::after {\n    display: none;\n  }\n}\n\n.kitchen-app {\n  max-width: 900px;\n  margin: 0 auto;\n  padding: 24px;\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n  font-family: monospace;\n  line-height: 1.3;\n}\n\n/* Page Title */\n.kitchen-title {\n  font-size: 28px;\n  font-weight: 600;\n  color: #333;\n  margin: 0;\n  font-family: monospace;\n}\n\n.kitchen-subtitle {\n  font-size: 14px;\n  font-weight: 400;\n  color: #666;\n  margin: 4px 0 0 0;\n  font-family: monospace;\n}\n\n/* Challenge Banner */\n.challenge-banner {\n  background: #fffde7;\n  border: 1px solid #ffc107;\n  border-radius: 12px;\n  padding: 20px;\n  text-align: center;\n}\n\n.challenge-title {\n  font-size: 20px;\n  font-weight: 600;\n  color: #333;\n  font-family: monospace;\n  margin: 0 0 8px 0;\n}\n\n.challenge-subtitle {\n  font-size: 14px;\n  font-weight: 400;\n  color: #666;\n  font-family: monospace;\n  margin: 0;\n}\n\n/* Section styling */\n.kitchen-section {\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 12px;\n  padding: 20px;\n}\n\n.section-title {\n  font-size: 15px;\n  font-weight: 600;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  color: #333;\n  margin: 0;\n  font-family: monospace;\n}\n\n.section-subtitle {\n  font-size: 13px;\n  color: #666;\n  margin: 4px 0 0 0;\n  font-weight: 400;\n  text-transform: none;\n  letter-spacing: normal;\n  font-family: monospace;\n}\n\n.section-header-text {\n  display: flex;\n  flex-direction: column;\n}\n\n/* Section header with title and action button */\n.section-header {\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n  margin-bottom: 16px;\n}\n\n.section-header .section-title {\n  margin: 0;\n}\n\n.section-count {\n  font-size: 14px;\n  font-weight: 700;\n  color: #666;\n  font-family: monospace;\n  white-space: nowrap;\n}\n\n.section-action-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 28px;\n  height: 28px;\n  border: none;\n  background: transparent;\n  color: #888;\n  cursor: pointer;\n  border-radius: 4px;\n  transition: all 0.15s ease;\n}\n\n.section-action-button:hover {\n  background: #f0f0f0;\n  color: #555;\n}\n\n.section-action-button .material-symbols-outlined {\n  font-size: 20px;\n}\n\n/* ============================================================================\n   Ingredients and Tools Row (Side by Side)\n   ============================================================================ */\n\n.ingredients-tools-row {\n  display: flex;\n  gap: 24px;\n}\n\n@media (max-width: 700px) {\n  .ingredients-tools-row {\n    flex-direction: column;\n  }\n}\n\n.ingredients-tools-row .kitchen-section {\n  flex: 1;\n}\n\n/* ============================================================================\n   Ingredients Grid\n   ============================================================================ */\n\n.ingredients-section {\n  max-height: 400px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n.ingredients-grid {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  overflow-y: auto;\n  flex: 1;\n  max-height: 320px;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  padding: 8px;\n}\n\n.ingredient-tile {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  background: white;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  padding: 10px 12px;\n  width: 100%;\n  box-sizing: border-box;\n  animation: slideIn 0.3s ease;\n}\n\n@keyframes slideIn {\n  from {\n    opacity: 0;\n    transform: translateY(-10px);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n.ingredient-tile:hover:not(:disabled) {\n  border-color: #666;\n  background: #f5f5f5;\n}\n\n.ingredient-tile:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n.ingredient-tile.selected {\n  border-color: var(--Blue-500);\n  background: var(--Blue-800);\n  box-shadow: 0 0 0 2px var(--Blue-400);\n}\n\n.ingredient-tile.selected .name {\n  color: white;\n}\n\n.ingredient-tile.active {\n  border-color: var(--Green-500);\n  background: #e8f5e9;\n  box-shadow: 0 0 0 2px #a5d6a7;\n}\n\n.ingredient-tile.active .name {\n  color: #1b5e20;\n}\n\n.ingredient-tile .name {\n  font-size: 13px;\n  color: #333;\n  text-align: left;\n  line-height: 1.2;\n  font-family: monospace;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.ingredient-tile .emoji {\n  font-size: 18px;\n  line-height: 1;\n  margin-right: 8px;\n}\n\n/* ============================================================================\n   Actions Grid (Tools)\n   ============================================================================ */\n\n.actions-section {\n  max-height: 400px;\n  overflow: hidden;\n  display: flex;\n  flex-direction: column;\n}\n\n.actions-grid {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  overflow-y: auto;\n  flex: 1;\n  max-height: 320px;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  padding: 8px;\n}\n\n.action-tile {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 12px;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  background: white;\n  cursor: pointer;\n  transition: all 0.15s ease;\n  text-align: left;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.action-tile:hover:not(:disabled) {\n  border-color: #666;\n  background: #f5f5f5;\n}\n\n.action-tile:disabled {\n  opacity: 0.4;\n  cursor: not-allowed;\n}\n\n.action-tile.active {\n  border-color: var(--Green-500);\n  background: #e8f5e9;\n}\n\n.action-tile .emoji {\n  font-size: 16px;\n  line-height: 1;\n}\n\n.action-tile .name {\n  font-family: monospace;\n  font-size: 13px;\n  color: #333;\n}\n\n/* ============================================================================\n   Timeline\n   ============================================================================ */\n\n.timeline-section {\n  min-height: 120px;\n}\n\n.timeline-container {\n  display: flex;\n  gap: 12px;\n  overflow-x: auto;\n  padding-bottom: 8px;\n  min-height: 80px;\n  align-items: stretch;\n}\n\n.timeline-empty {\n  color: #999;\n  font-size: 14px;\n  font-style: italic;\n}\n\n.timeline-item {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 8px;\n  padding: 12px 16px;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  background: white;\n  flex-shrink: 0;\n  transition: all 0.15s ease;\n  min-width: 150px;\n  max-width: 250px;\n}\n\n.timeline-item.loading {\n  border-style: dashed;\n  background: #fafafa;\n}\n\n.timeline-action {\n  font-family: monospace;\n  font-size: 13px;\n  color: #666;\n}\n\n.timeline-action .action-name {\n  color: #333;\n}\n\n.timeline-action .action-args {\n  color: #888;\n}\n\n.timeline-arrow {\n  display: none; /* Hide arrow, responses are now below */\n}\n\n.timeline-result {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.timeline-result-arrow {\n  font-size: 16px;\n  color: #666;\n  font-family: monospace;\n}\n\n.timeline-result .result-emoji {\n  font-size: 20px;\n}\n\n.timeline-result .result-name {\n  font-weight: 500;\n  color: #333;\n  font-family: monospace;\n}\n\n.timeline-result .spinner {\n  font-size: 20px;\n  animation: pulse 1s ease-in-out infinite;\n}\n\n@keyframes pulse {\n  0%, 100% { opacity: 1; }\n  50% { opacity: 0.5; }\n}\n\n/* Text-only entries from Cooking Agent */\n.timeline-item.timeline-text-only {\n  background: white;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  padding: 12px 16px;\n  max-width: 250px;\n  white-space: normal;\n  min-width: 150px;\n}\n\n.timeline-text-content {\n  font-size: 13px;\n  color: #666;\n  line-height: 1.4;\n  font-family: monospace;\n  margin-bottom: 4px;\n}\n\n/* Text within action cards - no extra margin on last item */\n.timeline-item .timeline-text-content:last-child {\n  margin-bottom: 0;\n}\n\n/* ============================================================================\n   Orders Section\n   ============================================================================ */\n\n.orders-grid {\n  display: flex;\n  gap: 16px;\n  flex-wrap: nowrap;\n  overflow-x: auto;\n  padding-bottom: 8px;\n}\n\n.order-card {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 12px;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  background: white;\n  min-width: 100px;\n  aspect-ratio: 4 / 3;\n  flex-shrink: 0;\n  transition: all 0.2s ease;\n}\n\n.order-card-action-button {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 24px;\n  height: 24px;\n  border: none;\n  background: transparent;\n  color: #888;\n  cursor: pointer;\n  border-radius: 4px;\n  transition: all 0.15s ease;\n}\n\n.order-card-action-button:hover {\n  background: rgba(0, 0, 0, 0.05);\n  color: #555;\n}\n\n.order-card-action-button .material-symbols-outlined {\n  font-size: 18px;\n}\n\n.order-card.add-order-card {\n  border-style: dashed;\n  border-color: #888;\n  background: #fafafa;\n  cursor: pointer;\n}\n\n.order-card.add-order-card:hover {\n  border-color: #666;\n  background: #f5f5f5;\n}\n\n.order-card.add-order-card.editing {\n  border-style: solid;\n  border-color: var(--Blue-400);\n  cursor: default;\n}\n\n.order-input {\n  width: 100%;\n  padding: 8px;\n  border: 1px solid #000;\n  border-radius: 4px;\n  font-size: 12px;\n  text-align: center;\n}\n\n/* Not started - grey background */\n.order-card.not-started {\n  border-color: #e0e0e0;\n  background: #f5f5f5;\n}\n\n/* In progress - yellow background */\n.order-card.in-progress {\n  border-color: #ffc107;\n  background: #fffde7;\n}\n\n.order-card.completed {\n  border-color: var(--Green-500);\n  background: #e8f5e9;\n}\n\n.order-card.failed {\n  border-color: #f44336;\n  background: #ffebee;\n}\n\n/* Disabled order cards */\n.order-card.disabled {\n  opacity: 0.5;\n  pointer-events: none;\n}\n\n.order-emoji {\n  font-size: 36px;\n  line-height: 1;\n}\n\n.order-name {\n  font-size: 14px;\n  font-weight: 600;\n  color: #333;\n  text-align: center;\n}\n\n.order-status {\n  font-size: 12px;\n  color: #666;\n  text-align: center;\n}\n\n.order-card.failed .order-status {\n  color: #c62828;\n  font-size: 11px;\n  max-width: 120px;\n  word-wrap: break-word;\n}\n\n/* Order difficulty tags */\n.order-difficulty {\n  position: absolute;\n  top: 6px;\n  left: 6px;\n  font-size: 10px;\n  font-weight: 600;\n  text-transform: uppercase;\n  padding: 2px 6px;\n  border-radius: 4px;\n  font-family: monospace;\n}\n\n.order-difficulty.difficulty-easy {\n  background: #e8f5e9;\n  color: #2e7d32;\n  border: 1px solid #81c784;\n}\n\n.order-difficulty.difficulty-intermediate {\n  background: #fff8e1;\n  color: #f57f17;\n  border: 1px solid #ffca28;\n}\n\n.order-difficulty.difficulty-difficult {\n  background: #ffebee;\n  color: #c62828;\n  border: 1px solid #ef9a9a;\n}\n\n/* Order buttons - base style */\n.order-button {\n  margin-top: 8px;\n  padding: 8px 12px;\n  background: #fff;\n  color: #333;\n  border: 1px solid #ccc;\n  border-radius: 6px;\n  font-size: 12px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.order-button:hover:not(:disabled) {\n  background: #f5f5f5;\n  border-color: #999;\n}\n\n.order-button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n/* Cook button - same as order button, no special styling */\n.order-button.cook-button {\n  background: #fff;\n  color: #333;\n  border: 1px solid #ccc;\n}\n\n.order-button.cook-button:hover {\n  background: #f5f5f5;\n  border-color: #999;\n}\n\n/* ============================================================================\n   Agents Section\n   ============================================================================ */\n\n.agents-section {\n  max-width: 100%;\n}\n\n.agents-grid {\n  display: flex;\n  gap: 16px;\n  flex-wrap: wrap;\n  max-width: 100%;\n}\n\n@media (max-width: 700px) {\n  .agents-grid {\n    flex-direction: column;\n  }\n}\n\n.agent-card {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  padding: 20px;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  background: white;\n  min-width: 160px;\n  max-width: 300px;\n  flex: 1;\n}\n\n.agent-card-wide {\n  flex: 2;\n  min-width: 240px;\n  max-width: 400px;\n}\n\n.agent-card-header {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n}\n\n.agent-emoji {\n  font-size: 28px;\n  line-height: 1;\n}\n\n.agent-name {\n  font-size: 16px;\n  font-weight: 600;\n  color: #333;\n  font-family: monospace;\n}\n\n.agent-description {\n  font-size: 13px;\n  color: #666;\n  margin: 0;\n  font-family: monospace;\n  line-height: 1.4;\n}\n\n.agent-actions {\n  display: flex;\n  gap: 10px;\n  flex-wrap: wrap;\n  margin-top: auto;\n}\n\n.agent-cook-button {\n  flex: 1;\n  padding: 12px 16px;\n  background: #f9a825;\n  color: #000;\n  border: none;\n  border-radius: 6px;\n  font-size: 13px;\n  font-weight: 700;\n  font-family: monospace;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  min-width: 140px;\n}\n\n.agent-cook-button:hover:not(:disabled) {\n  background: #f57f17;\n}\n\n.agent-cook-button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n  background: #ccc;\n  color: #666;\n}\n\n.agent-view-button {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 10px 16px;\n  background: #f5f5f5;\n  color: #555;\n  border: 1px solid #ccc;\n  border-radius: 6px;\n  font-size: 13px;\n  font-weight: 500;\n  font-family: monospace;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.agent-view-button:hover {\n  background: #e8e8e8;\n  border-color: #999;\n}\n\n.agent-view-button .material-symbols-outlined {\n  font-size: 18px;\n}\n\n.agent-view-button:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n/* ============================================================================\n   Light scrollbar styling\n   ============================================================================ */\n\n.kitchen-app,\n.kitchen-app * {\n  scrollbar-color: #c1c1c1 #f1f1f1;\n  scrollbar-width: thin;\n}\n\n.kitchen-app ::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n.kitchen-app ::-webkit-scrollbar-track {\n  background: #f1f1f1;\n  border-radius: 4px;\n}\n\n.kitchen-app ::-webkit-scrollbar-thumb {\n  background: #c1c1c1;\n  border-radius: 4px;\n}\n\n.kitchen-app ::-webkit-scrollbar-thumb:hover {\n  background: #a1a1a1;\n}\n\n/* ============================================================================\n   Attribution Footer\n   ============================================================================ */\n\n.attribution-footer {\n  text-align: center;\n  padding: 24px 0;\n  font-family: monospace;\n  font-size: 12px;\n  color: #888;\n}\n\n.attribution-footer a {\n  color: #888;\n  text-decoration: none;\n}\n\n.attribution-footer a:hover {\n  color: #666;\n  text-decoration: underline;\n}\n\n/* Mobile styles for kitchen app */\n@media (max-width: 600px) {\n  .kitchen-app {\n    padding: 12px;\n    gap: 16px;\n  }\n\n  .kitchen-title {\n    font-size: 24px;\n  }\n\n  .kitchen-subtitle {\n    font-size: 13px;\n  }\n\n  .kitchen-section {\n    padding: 12px;\n  }\n}",
      "role": "STYLE",
      "language": "css",
      "size": 17197,
      "order": 2
    },
    {
      "path": "App.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport \"./App.css\";\nimport { GeminiAPIProvider, useGeminiAPIContext } from \"./gemini/contexts/GeminiAPIContext\";\nimport GeminiDebug from \"./gemini/components/GeminiDebug\";\nimport { Content, FunctionCall } from '@google/genai';\nimport {\n  Ingredient,\n  KitchenAction,\n  TimelineEntry,\n  CombinationResult,\n  Order,\n  VerificationResult,\n  COOKING_ACTIONS,\n  STARTING_INGREDIENTS,\n  PRESELECTED_INGREDIENTS,\n  EXAMPLE_ORDERS,\n  COMBINATION_SYSTEM_INSTRUCTION,\n  COMBINATION_RESPONSE_SCHEMA,\n  VERIFICATION_SYSTEM_INSTRUCTION,\n  VERIFICATION_RESPONSE_SCHEMA,\n  generateCookingTools,\n  buildCookingAgentSystemInstruction,\n} from './constants';\n\n// ============================================================================\n// Ingredient Normalization Helper\n// ============================================================================\n\n/**\n * Normalizes ingredient names for case/spacing/symbol insensitive comparison.\n * Removes all non-alphanumeric characters and converts to lowercase.\n */\nfunction normalizeIngredientName(name: string): string {\n  return name.toLowerCase().replace(/[^a-z0-9]/g, '');\n}\n\n/**\n * Finds an ingredient in the inventory using normalized name comparison.\n * Returns the actual inventory item if found, null otherwise.\n */\nfunction findIngredientInInventory(name: string, inventory: Ingredient[]): Ingredient | null {\n  const normalizedSearch = normalizeIngredientName(name);\n  return inventory.find(ing => normalizeIngredientName(ing.name) === normalizedSearch) || null;\n}\n\n/**\n * Checks if an ingredient already exists in the inventory using normalized comparison.\n */\nfunction isDuplicateIngredient(name: string, inventory: Ingredient[]): boolean {\n  return findIngredientInInventory(name, inventory) !== null;\n}\n\n// ============================================================================\n// Ingredient Tile Component\n// ============================================================================\n\ninterface IngredientTileProps {\n  ingredient: Ingredient;\n  isSelected: boolean;\n  isActive: boolean;\n  isDisabled: boolean;\n  onClick: () => void;\n}\n\nfunction IngredientTile({ ingredient, isSelected, isActive, isDisabled, onClick }: IngredientTileProps) {\n  return (\n    <button\n      className={`ingredient-tile ${isSelected ? 'selected' : ''} ${isActive ? 'active' : ''}`}\n      onClick={onClick}\n      title={ingredient.name}\n      data-ingredient={ingredient.name}\n      disabled={isDisabled}\n    >\n      <span className=\"emoji\">{ingredient.emoji}</span>\n      <span className=\"name\">{ingredient.name}</span>\n    </button>\n  );\n}\n\n// ============================================================================\n// Action Tile Component\n// ============================================================================\n\ninterface ActionTileProps {\n  action: KitchenAction;\n  isActive: boolean;\n  isDisabled: boolean;\n  onClick: () => void;\n}\n\nfunction ActionTile({ action, isActive, isDisabled, onClick }: ActionTileProps) {\n  return (\n    <button\n      className={`action-tile ${isActive ? 'active' : ''}`}\n      onClick={onClick}\n      disabled={isDisabled}\n      title={action.displayName}\n      data-action={action.name}\n    >\n      <span className=\"emoji\">{action.emoji}</span>\n      <span className=\"name\">{action.name}()</span>\n    </button>\n  );\n}\n\n// ============================================================================\n// Timeline Item Component\n// ============================================================================\n\ninterface TimelineItemProps {\n  entry: TimelineEntry;\n}\n\nfunction TimelineItem({ entry }: TimelineItemProps) {\n  const hasAction = entry.action && entry.ingredients;\n  const hasText = entry.text;\n  const isLoading = hasAction && entry.result === null;\n\n  // Text-only entry\n  if (hasText && !hasAction) {\n    return (\n      <div className=\"timeline-item timeline-text-only\">\n        <div className=\"timeline-text-content\">\n          {entry.text}\n        </div>\n      </div>\n    );\n  }\n\n  // Action entry (possibly with text)\n  return (\n    <div className={`timeline-item ${isLoading ? 'loading' : ''}`}>\n      {hasText && (\n        <div className=\"timeline-text-content\">\n          {entry.text}\n        </div>\n      )}\n      {hasAction && (\n        <>\n          <div className=\"timeline-action\">\n            <span className=\"action-name\">{entry.action}(</span>\n            <span className=\"action-args\">{entry.ingredients?.join(', ')}</span>\n            <span className=\"action-name\">)</span>\n          </div>\n          <div className=\"timeline-result\">\n            <span className=\"timeline-result-arrow\">\u21b3</span>\n            {isLoading ? (\n              <span className=\"spinner\">\u23f3</span>\n            ) : (\n              <>\n                <span className=\"result-emoji\">{entry.result!.emoji}</span>\n                <span className=\"result-name\">{entry.result!.name}</span>\n              </>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Order Card Component\n// ============================================================================\n\ninterface OrderCardProps {\n  order: Order;\n  isDisabled: boolean;\n  onPickUp: (orderId: string) => void;\n  onCookWithGemini: (orderName: string) => void;\n  onOpenVerificationAgent?: () => void;\n}\n\nfunction OrderCard({ order, isDisabled, onPickUp, onCookWithGemini, onOpenVerificationAgent }: OrderCardProps) {\n  const statusClass = order.status === 'completed' ? 'completed' :\n    order.status === 'failed' ? 'failed' :\n      order.status === 'in_progress' ? 'in-progress' : 'not-started';\n\n  const difficultyClass = order.difficulty ? `difficulty-${order.difficulty}` : '';\n\n  return (\n    <div className={`order-card ${statusClass} ${isDisabled ? 'disabled' : ''}`}>\n      {order.difficulty && (\n        <div className={`order-difficulty ${difficultyClass}`}>\n          {order.difficulty}\n        </div>\n      )}\n      <div className=\"order-emoji\">{order.emoji}</div>\n      <div className=\"order-name\">{order.name}</div>\n      <div className=\"order-status\">\n        {order.status === 'completed' && '\u2705 Completed'}\n        {order.status === 'failed' && `\u274c ${order.servedDish}`}\n        {order.status === 'in_progress' && '\ud83d\udd04 Started'}\n        {order.status === 'not_started' && 'Not started'}\n      </div>\n      {order.status === 'not_started' && (\n        <button\n          className=\"order-button\"\n          onClick={() => onPickUp(order.id)}\n          disabled={isDisabled}\n        >\n          Start\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================================================\n// Add Order Card Component\n// ============================================================================\n\ninterface AddOrderCardProps {\n  onAddOrder: (orderName: string) => void;\n  isDisabled?: boolean;\n}\n\nfunction AddOrderCard({ onAddOrder, isDisabled }: AddOrderCardProps) {\n  const [isEditing, setIsEditing] = useState(false);\n  const [orderName, setOrderName] = useState('');\n  const inputRef = useRef<HTMLInputElement>(null);\n\n  useEffect(() => {\n    if (isEditing && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [isEditing]);\n\n  const handleSubmit = () => {\n    if (orderName.trim()) {\n      onAddOrder(orderName.trim());\n      setOrderName('');\n      setIsEditing(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      handleSubmit();\n    } else if (e.key === 'Escape') {\n      setOrderName('');\n      setIsEditing(false);\n    }\n  };\n\n  if (!isEditing) {\n    return (\n      <div\n        className={`order-card add-order-card ${isDisabled ? 'disabled' : ''}`}\n        onClick={() => !isDisabled && setIsEditing(true)}\n      >\n        <div className=\"order-emoji\">\ud83d\udccb</div>\n        <div className=\"order-name\">Add New Order</div>\n        <div className=\"order-status\">{isDisabled ? 'Click to add' : 'Click to add'}</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"order-card add-order-card editing\">\n      <div className=\"order-emoji\">\ud83d\udccb</div>\n      <input\n        ref={inputRef}\n        type=\"text\"\n        className=\"order-input\"\n        placeholder=\"Enter dish name...\"\n        value={orderName}\n        onChange={(e) => setOrderName(e.target.value)}\n        onKeyDown={handleKeyDown}\n        onBlur={() => {\n          if (!orderName.trim()) {\n            setIsEditing(false);\n          }\n        }}\n      />\n      <button className=\"cook-button\" onClick={handleSubmit} disabled={!orderName.trim()}>\n        \u2795 Add Order\n      </button>\n    </div>\n  );\n}\n\n// ============================================================================\n// Combination Agent Component (Layer 1)\n// ============================================================================\n\ninterface CombinationAgentProps {\n  inventory: Ingredient[];\n  setInventory: React.Dispatch<React.SetStateAction<Ingredient[]>>;\n  timeline: TimelineEntry[];\n  setTimeline: React.Dispatch<React.SetStateAction<TimelineEntry[]>>;\n  selectedIngredients: Set<string>;\n  setSelectedIngredients: React.Dispatch<React.SetStateAction<Set<string>>>;\n  activeAction: string | null;\n  setActiveAction: React.Dispatch<React.SetStateAction<string | null>>;\n  actionTriggerCount: number;\n  onExecuteActionRef: React.MutableRefObject<((action: KitchenAction, ingredients: string[]) => Promise<Ingredient | null>) | null>;\n  orders: Order[];\n  onCookWithGemini: (orderName: string) => void;\n  onPickUp: (orderId: string) => void;\n  onAddOrder: (orderName: string) => void;\n  onServe: (servedDishName: string) => void;\n  onOpenCombinationAgent: () => void;\n  onOpenCookingAgent: () => void;\n  onOpenVerificationAgent: () => void;\n  activeIngredients: Set<string>;\n  setActiveIngredients: React.Dispatch<React.SetStateAction<Set<string>>>;\n  isCooking: boolean;\n  isCookingAgentOpen: boolean;\n  isAlchemyAgentOpen: boolean;\n  isJudgeAgentOpen: boolean;\n}\n\nfunction CombinationAgent({\n  inventory,\n  setInventory,\n  timeline,\n  setTimeline,\n  selectedIngredients,\n  setSelectedIngredients,\n  activeAction,\n  setActiveAction,\n  actionTriggerCount,\n  onExecuteActionRef,\n  orders,\n  onCookWithGemini,\n  onPickUp,\n  onAddOrder,\n  onServe,\n  onOpenCombinationAgent,\n  onOpenCookingAgent,\n  onOpenVerificationAgent,\n  activeIngredients,\n  setActiveIngredients,\n  isCooking,\n  isCookingAgentOpen,\n  isAlchemyAgentOpen,\n  isJudgeAgentOpen,\n}: CombinationAgentProps) {\n  const { generateContent, setConfig } = useGeminiAPIContext();\n\n  // Refs for auto-scroll\n  const ingredientsRef = useRef<HTMLDivElement>(null);\n  const actionsRef = useRef<HTMLDivElement>(null);\n  const timelineRef = useRef<HTMLDivElement>(null);\n  const hasScrolledRef = useRef(false);\n  const prevInventoryLengthRef = useRef(inventory.length);\n\n  // Set config on mount\n  useEffect(() => {\n    setConfig({\n      systemInstruction: COMBINATION_SYSTEM_INSTRUCTION,\n      responseMimeType: 'application/json',\n      responseSchema: COMBINATION_RESPONSE_SCHEMA,\n      thinkingConfig: {\n        thinkingBudget: 0,\n      },\n    });\n  }, [setConfig]);\n\n  // Toggle ingredient selection\n  const toggleIngredient = useCallback((name: string) => {\n    setSelectedIngredients(prev => {\n      const next = new Set(prev);\n      if (next.has(name)) {\n        next.delete(name);\n      } else {\n        next.add(name);\n      }\n      return next;\n    });\n  }, [setSelectedIngredients]);\n\n  // Core execution logic - shared with Cooking Agent\n  const executeCombination = useCallback(async (\n    action: KitchenAction,\n    ingredientNames: string[]\n  ): Promise<Ingredient | null> => {\n    try {\n      const prompt = `Action: ${action.displayName}\\nIngredients: ${ingredientNames.join(', ')}\\n\\nWhat is the result of this cooking action?`;\n\n      const contents: Content[] = [\n        { role: 'user', parts: [{ text: prompt }] }\n      ];\n\n      const response = await generateContent(contents);\n      const text = response?.text || '{}';\n      const result: CombinationResult = JSON.parse(text);\n\n      return {\n        name: result.result_name,\n        emoji: result.emoji,\n      };\n    } catch (error) {\n      console.error('Error in combination:', error);\n      return null;\n    }\n  }, [generateContent]);\n\n  // Expose the execution function to Cooking Agent via ref\n  useEffect(() => {\n    onExecuteActionRef.current = executeCombination;\n    return () => {\n      onExecuteActionRef.current = null;\n    };\n  }, [executeCombination, onExecuteActionRef]);\n\n  // Manual execution (UI click)\n  const executeAction = useCallback(async (action: KitchenAction) => {\n    if (selectedIngredients.size === 0) return;\n\n    const ingredientNames = Array.from(selectedIngredients);\n\n    // Clear selection immediately\n    setSelectedIngredients(new Set());\n\n    // Handle serve action specially - only triggers verification, no combination\n    if (action.name === 'serve') {\n      // Serve takes only the first selected ingredient as the dish name\n      const dishName = ingredientNames[0];\n\n      // Add serve to timeline\n      setTimeline(prev => [...prev, {\n        id: `serve-${Date.now()}`,\n        type: 'text' as const,\n        action: '',\n        ingredients: [],\n        result: null,\n        text: `\ud83c\udf7d\ufe0f Served: ${dishName}`,\n        timestamp: new Date(),\n      }]);\n\n      // Trigger verification agent\n      onServe(dishName);\n      return;\n    }\n\n    // Regular cooking actions - use combination agent\n    const timelineId = `${Date.now()}`;\n\n    // Add loading placeholder to timeline\n    const loadingEntry: TimelineEntry = {\n      id: timelineId,\n      timestamp: new Date(),\n      action: action.name,\n      ingredients: ingredientNames,\n      result: null,\n    };\n    setTimeline(prev => [...prev, loadingEntry]);\n    setActiveAction(action.name);\n\n    const newIngredient = await executeCombination(action, ingredientNames);\n\n    if (newIngredient) {\n      // Update timeline with result\n      setTimeline(prev => prev.map(entry =>\n        entry.id === timelineId\n          ? { ...entry, result: newIngredient }\n          : entry\n      ));\n\n      // Add to inventory (at the beginning for recently used items at top)\n      // But skip if this ingredient already exists (duplicate check)\n      setInventory(prev => {\n        if (isDuplicateIngredient(newIngredient.name, prev)) {\n          console.log(`Skipping duplicate ingredient: ${newIngredient.name}`);\n          return prev;\n        }\n        return [newIngredient, ...prev];\n      });\n    } else {\n      // Update timeline with error\n      setTimeline(prev => prev.map(entry =>\n        entry.id === timelineId\n          ? { ...entry, result: { name: 'error', emoji: '\u274c' } }\n          : entry\n      ));\n    }\n\n    setActiveAction(null);\n  }, [selectedIngredients, executeCombination, setTimeline, setActiveAction, setSelectedIngredients, setInventory, onServe]);\n\n  // Auto-scroll timeline when new item added\n  useEffect(() => {\n    if (timelineRef.current) {\n      timelineRef.current.scrollLeft = timelineRef.current.scrollWidth;\n    }\n  }, [timeline.length]);\n\n  // Auto-scroll ingredients and tools sections on first load to show length\n  useEffect(() => {\n    if (hasScrolledRef.current) return;\n    hasScrolledRef.current = true;\n\n    // Small delay to ensure elements are rendered\n    const timer = setTimeout(() => {\n      if (ingredientsRef.current) {\n        ingredientsRef.current.scrollTo({\n          top: ingredientsRef.current.scrollHeight,\n          behavior: 'smooth'\n        });\n      }\n      if (actionsRef.current) {\n        actionsRef.current.scrollTo({\n          top: actionsRef.current.scrollHeight,\n          behavior: 'smooth'\n        });\n      }\n    }, 300);\n\n    return () => clearTimeout(timer);\n  }, []);\n\n  // Scroll new ingredient into view when added\n  useEffect(() => {\n    if (inventory.length > prevInventoryLengthRef.current && ingredientsRef.current) {\n      // New ingredient was added at the beginning - scroll to top\n      ingredientsRef.current.scrollTo({\n        top: 0,\n        behavior: 'smooth'\n      });\n    }\n    prevInventoryLengthRef.current = inventory.length;\n  }, [inventory.length]);\n\n  // Scroll active tool into view when action is triggered (container-only scroll)\n  useEffect(() => {\n    // Only run when trigger count changes (indicates a new action)\n    if (actionTriggerCount === 0) return;\n\n    requestAnimationFrame(() => {\n      const container = actionsRef.current;\n      if (!container || !activeAction) return;\n      const actionElement = container.querySelector(`[data-action=\"${activeAction}\"]`) as HTMLElement;\n      if (actionElement) {\n        // Calculate scroll position within container only\n        const containerRect = container.getBoundingClientRect();\n        const elementRect = actionElement.getBoundingClientRect();\n        const scrollTop = container.scrollTop + (elementRect.top - containerRect.top) - containerRect.height / 2 + elementRect.height / 2;\n        container.scrollTo({ top: scrollTop, behavior: 'smooth' });\n      }\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [actionTriggerCount, activeAction]);\n\n\n\n\n\n  const hasSelection = selectedIngredients.size > 0;\n\n  // Get the current in-progress order name\n  const currentOrder = orders.find(o => o.status === 'in_progress');\n\n  return (\n    <div className=\"kitchen-app\">\n      {/* Page Title */}\n      <div className=\"kitchen-header\">\n        <h1 className=\"kitchen-title\">Function Calling Kitchen</h1>\n        <p className=\"kitchen-subtitle\">Challenge Gemini 3 Flash's function calling capabilities:</p>\n      </div>\n\n      {/* Challenge Banner */}\n      <div className=\"challenge-banner\">\n        <div className=\"challenge-title\">\ud83e\uddd1\u200d\ud83c\udf73 ULTIMATE FUNCTION CALLING CHALLENGE! \ud83e\uddd1\u200d\ud83c\udf73</div>\n        <div className=\"challenge-subtitle\">Sequence tasks from 100 tools and 100 ingredients to prepare a meal</div>\n      </div>\n\n      {/* Orders Section */}\n      <section className=\"kitchen-section orders-section\">\n        <div className=\"section-header\">\n          <div className=\"section-header-text\">\n            <h2 className=\"section-title\">Orders</h2>\n            <p className=\"section-subtitle\">Customer orders to fulfill with function calling</p>\n          </div>\n        </div>\n        <div className=\"orders-grid\">\n          {(() => {\n            const hasInProgressOrder = orders.some(o => o.status === 'in_progress');\n            return (\n              <>\n                {orders.map(order => (\n                  <OrderCard\n                    key={order.id}\n                    order={order}\n                    isDisabled={hasInProgressOrder && order.status === 'not_started'}\n                    onPickUp={onPickUp}\n                    onCookWithGemini={onCookWithGemini}\n                    onOpenVerificationAgent={onOpenVerificationAgent}\n                  />\n                ))}\n                <AddOrderCard onAddOrder={onAddOrder} isDisabled={hasInProgressOrder} />\n              </>\n            );\n          })()}\n        </div>\n      </section>\n\n      {/* Ingredients and Tools Side by Side */}\n      <div className=\"ingredients-tools-row\">\n        {/* Ingredients Section */}\n        <section className=\"kitchen-section ingredients-section\">\n          <div className=\"section-header\">\n            <div className=\"section-header-text\">\n              <h2 className=\"section-title\">Ingredients</h2>\n              <p className=\"section-subtitle\">Select ingredients to use as function arguments</p>\n            </div>\n            <span className=\"section-count\">count: {inventory.length}</span>\n          </div>\n          <div className=\"ingredients-grid\" ref={ingredientsRef}>\n            {inventory.map((ingredient, index) => (\n              <IngredientTile\n                key={`${ingredient.name}-${index}-${actionTriggerCount}`}\n                ingredient={ingredient}\n                isSelected={selectedIngredients.has(ingredient.name)}\n                isActive={false}\n                isDisabled={!currentOrder}\n                onClick={() => toggleIngredient(ingredient.name)}\n              />\n            ))}\n          </div>\n        </section>\n\n        {/* Tools Section */}\n        <section className=\"kitchen-section actions-section\">\n          <div className=\"section-header\">\n            <div className=\"section-header-text\">\n              <h2 className=\"section-title\">Tools</h2>\n              <p className=\"section-subtitle\">Use function calls to combine ingredients</p>\n            </div>\n            <span className=\"section-count\">count: {COOKING_ACTIONS.length}</span>\n          </div>\n          <div className=\"actions-grid\" ref={actionsRef}>\n            {COOKING_ACTIONS.map(action => {\n              // Serve requires exactly one ingredient selected\n              const isServeDisabled = action.name === 'serve' && selectedIngredients.size !== 1;\n              // Don't disable tools while cooking agent is running\n              const isDisabled = isCooking ? false : (!hasSelection || activeAction !== null || isServeDisabled);\n\n              return (\n                <ActionTile\n                  key={`${action.name}-${actionTriggerCount}`}\n                  action={action}\n                  isActive={false}\n                  isDisabled={isDisabled}\n                  onClick={() => executeAction(action)}\n                />\n              );\n            })}\n          </div>\n        </section>\n      </div>\n\n      {/* Agents Section */}\n      <section className=\"kitchen-section agents-section\">\n        <div className=\"section-header\">\n          <div className=\"section-header-text\">\n            <h2 className=\"section-title\">Agents</h2>\n            <p className=\"section-subtitle\">Three specialized Gemini 3 Flash agents</p>\n          </div>\n        </div>\n        <div className=\"agents-grid\">\n          {/* Cooking Agent - Double Width */}\n          <div className=\"agent-card agent-card-wide\">\n            <div className=\"agent-card-header\">\n              <span className=\"agent-emoji\">\ud83e\uddd1\u200d\ud83c\udf73</span>\n              <span className=\"agent-name\">Cooking Agent</span>\n            </div>\n            <p className=\"agent-description\">Orchestrates cooking using available tools and ingredients</p>\n            <div className=\"agent-actions\">\n              <button\n                className=\"agent-cook-button\"\n                onClick={() => currentOrder && onCookWithGemini(currentOrder.name)}\n                disabled={!currentOrder || isCooking}\n              >\n                {isCooking ? 'Cooking...' : currentOrder ? `Start cooking '${currentOrder.name}'` : 'Start an order'}\n              </button>\n              <button\n                className=\"agent-view-button\"\n                onClick={onOpenCookingAgent}\n                disabled={isCookingAgentOpen}\n              >\n                <span className=\"material-symbols-outlined\">search</span>\n                Open\n              </button>\n            </div>\n          </div>\n\n          {/* Alchemy Agent */}\n          <div className=\"agent-card\">\n            <div className=\"agent-card-header\">\n              <span className=\"agent-emoji\">\ud83e\uddd1\u200d\ud83d\udd2c</span>\n              <span className=\"agent-name\">Alchemy Agent</span>\n            </div>\n            <p className=\"agent-description\">Determines results of cooking actions</p>\n            <div className=\"agent-actions\">\n              <button\n                className=\"agent-view-button\"\n                onClick={onOpenCombinationAgent}\n                disabled={isAlchemyAgentOpen}\n              >\n                <span className=\"material-symbols-outlined\">search</span>\n                Open\n              </button>\n            </div>\n          </div>\n\n          {/* Judge Agent */}\n          <div className=\"agent-card\">\n            <div className=\"agent-card-header\">\n              <span className=\"agent-emoji\">\ud83e\uddd1\u200d\u2696\ufe0f</span>\n              <span className=\"agent-name\">Judge Agent</span>\n            </div>\n            <p className=\"agent-description\">Verifies if served dishes match orders</p>\n            <div className=\"agent-actions\">\n              <button\n                className=\"agent-view-button\"\n                onClick={onOpenVerificationAgent}\n                disabled={isJudgeAgentOpen}\n              >\n                <span className=\"material-symbols-outlined\">search</span>\n                Open\n              </button>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Timeline Section */}\n      <section className=\"kitchen-section timeline-section\">\n        <div className=\"section-header\">\n          <div className=\"section-header-text\">\n            <h2 className=\"section-title\">Kitchen Log</h2>\n            <p className=\"section-subtitle\">Chat history showing all cooking actions and results</p>\n          </div>\n        </div>\n        <div className=\"timeline-container\" ref={timelineRef}>\n          {timeline.length === 0 ? (\n            <div className=\"timeline-empty\">\n              Select ingredients and click an action to start cooking\n            </div>\n          ) : (\n            timeline.map(entry => (\n              <TimelineItem key={entry.id} entry={entry} />\n            ))\n          )}\n        </div>\n      </section>\n    </div>\n  );\n}\n\n// ============================================================================\n// Cooking Agent Component (Layer 2)\n// ============================================================================\n\ninterface CookingAgentProps {\n  inventory: Ingredient[];\n  setInventory: React.Dispatch<React.SetStateAction<Ingredient[]>>;\n  setTimeline: React.Dispatch<React.SetStateAction<TimelineEntry[]>>;\n  setActiveAction: React.Dispatch<React.SetStateAction<string | null>>;\n  setActionTriggerCount: React.Dispatch<React.SetStateAction<number>>;\n  setActiveIngredients: React.Dispatch<React.SetStateAction<Set<string>>>;\n  executeCombinationRef: React.MutableRefObject<((action: KitchenAction, ingredients: string[]) => Promise<Ingredient | null>) | null>;\n  sendMessageRef: React.MutableRefObject<((message: string) => void) | null>;\n  onServe: (servedDishName: string) => Promise<boolean>;\n  onPass: () => void;\n}\n\nfunction CookingAgent({\n  inventory,\n  setInventory,\n  setTimeline,\n  setActiveAction,\n  setActionTriggerCount,\n  setActiveIngredients,\n  executeCombinationRef,\n  sendMessageRef,\n  onServe,\n  onPass,\n}: CookingAgentProps) {\n  const { client, setConfig, sendMessage } = useGeminiAPIContext();\n\n  // Update config when inventory changes - enable thinking for cooking agent\n  useEffect(() => {\n    setConfig({\n      systemInstruction: buildCookingAgentSystemInstruction(inventory),\n      tools: generateCookingTools(),\n      // No thinkingBudget - enable thinking for cooking agent\n    });\n  }, [setConfig, inventory]);\n\n  // Store pending text from model response to merge with function call\n  const pendingTextRef = useRef<string | null>(null);\n\n  // Watch for model responses and store text for merging\n  useEffect(() => {\n    const handleLog = (log: any) => {\n      // Only process incoming send-message responses\n      if (log.type !== 'send-message' || log.direction !== 'receive') return;\n\n      const response = log.message;\n      if (!response) return;\n\n      // Extract text from response\n      const text = response.text;\n      if (text && text.trim()) {\n        // Check if this response also has function calls\n        const hasFunctionCalls = response.candidates?.[0]?.content?.parts?.some(\n          (part: any) => part.functionCall\n        ) || response.functionCalls?.length > 0;\n\n        if (hasFunctionCalls) {\n          // Store text to merge with function call entry\n          pendingTextRef.current = text;\n        } else {\n        // Text-only response, add as standalone entry\n          setTimeline(prev => {\n          // Check if we already have this text (avoid duplicates)\n            const hasText = prev.some(e => e.text === text && !e.action);\n            if (hasText) return prev;\n\n            return [...prev, {\n              id: `text-${Date.now()}-${Math.random()}`,\n              timestamp: new Date(),\n              text: text,\n            }];\n          });\n        }\n      }\n    };\n\n    // Listen for log events\n    (client as any).on('log', handleLog);\n    return () => {\n      (client as any).off('log', handleLog);\n    };\n  }, [client, setTimeline]);\n\n  // Handle approved function calls from the Cooking Agent\n  useEffect(() => {\n    const handleApprovedFunctionCalls = async (functionCalls: FunctionCall[]) => {\n      if (functionCalls.length === 0) return;\n\n      // Process only the first function call (enforce one at a time)\n      const fc = functionCalls[0];\n      if (functionCalls.length > 1) {\n        console.warn('Cooking Agent returned multiple function calls, only processing the first one');\n      }\n\n      const actionName = fc.name || '';\n      const args = fc.args as { ingredients?: string[]; dish?: string } || {};\n\n      // Handle serve action\n      if (actionName === 'serve') {\n        const dishName = args.dish || 'dish';\n        console.log(`\ud83c\udf7d\ufe0f Serving: ${dishName}`);\n\n        // Add serve to timeline\n        setTimeline(prev => [...prev, {\n          id: `serve-${Date.now()}`,\n          timestamp: new Date(),\n          text: `\ud83c\udf7d\ufe0f Served: ${dishName}`,\n        }]);\n\n        // Trigger verification agent and wait for result\n        const verificationSuccess = await onServe(dishName);\n\n        // Send function response based on verification result\n        await sendMessage([{\n          functionResponse: {\n            name: 'serve',\n            response: verificationSuccess\n              ? { success: true, message: `${dishName} has been served and verified!` }\n              : { success: false, error: `${dishName} did not match any pending order. Please try again.` }\n          }\n        }]);\n        return;\n      }\n\n      // Handle pass action - give up on current order\n      if (actionName === 'pass') {\n        console.log('\ud83c\udff3\ufe0f Passing on current order');\n\n        // Notify parent to mark the current order as failed\n        onPass();\n\n        // Add pass to timeline\n        setTimeline(prev => [...prev, {\n          id: `pass-${Date.now()}`,\n          timestamp: new Date(),\n          text: '\ud83c\udff3\ufe0f Called pass on the order',\n        }]);\n\n        // Send function response confirming the pass\n        await sendMessage([{\n          functionResponse: {\n            name: 'pass',\n            response: { success: true, message: 'Order has been abandoned.' }\n          }\n        }]);\n        return;\n      }\n\n      // Handle cooking actions\n      const requestedIngredients = args.ingredients || [];\n      const timelineId = `cooking-${Date.now()}`;\n\n      // Find the action\n      const action = COOKING_ACTIONS.find(a => a.name === actionName);\n      if (!action) {\n        console.error(`Unknown action: ${actionName}`);\n        await sendMessage([{\n          functionResponse: {\n            name: actionName,\n            response: { success: false, error: `Unknown action: ${actionName}` }\n          }\n        }]);\n        return;\n      }\n\n      // Validate all requested ingredients exist in inventory (case/spacing/symbol insensitive)\n      const validatedIngredients: string[] = [];\n      const missingIngredients: string[] = [];\n      for (const requestedName of requestedIngredients) {\n        const found = findIngredientInInventory(requestedName, inventory);\n        if (found) {\n          // Use the actual inventory name (normalized match found)\n          // Avoid adding duplicates to the validated list\n          const normalizedFound = normalizeIngredientName(found.name);\n          if (!validatedIngredients.some(v => normalizeIngredientName(v) === normalizedFound)) {\n            validatedIngredients.push(found.name);\n          }\n        } else {\n          missingIngredients.push(requestedName);\n        }\n      }\n\n      // If any ingredients are missing, send an error response\n      if (missingIngredients.length > 0) {\n        console.error(`Ingredients not found in inventory: ${missingIngredients.join(', ')}`);\n        await sendMessage([{\n          functionResponse: {\n            name: actionName,\n            response: {\n              success: false,\n              error: `Ingredients not found in inventory: ${missingIngredients.join(', ')}. Please only use ingredients that exist in the current inventory.`\n            }\n          }\n        }]);\n        return;\n      }\n\n      // Use validated ingredients (with actual inventory names) going forward\n      const ingredients = validatedIngredients;\n\n      // Add loading placeholder (include any pending text from model response)\n      const pendingText = pendingTextRef.current;\n      pendingTextRef.current = null; // Clear pending text\n\n      const loadingEntry: TimelineEntry = {\n        id: timelineId,\n        timestamp: new Date(),\n        text: pendingText || undefined,\n        action: actionName,\n        ingredients: ingredients,\n        result: null,\n      };\n      setTimeline(prev => [...prev, loadingEntry]);\n      setActiveAction(actionName);\n      setActionTriggerCount(prev => prev + 1);\n      setActiveIngredients(new Set(ingredients));\n\n      try {\n        // Call the Combination Agent via the shared ref\n        let newIngredient: Ingredient | null = null;\n\n        if (executeCombinationRef.current) {\n          newIngredient = await executeCombinationRef.current(action, ingredients);\n        }\n\n        if (!newIngredient) {\n          // Fallback if combination agent unavailable\n          newIngredient = {\n            name: `${action.displayName}ed ${ingredients.join(' & ')}`,\n            emoji: action.emoji,\n          };\n        }\n\n        // Update timeline\n        setTimeline(prev => prev.map(entry =>\n          entry.id === timelineId\n            ? { ...entry, result: newIngredient }\n            : entry\n        ));\n\n        // Add to inventory (at the beginning for recently used items at top)\n        // But skip if this ingredient already exists (duplicate check)\n        setInventory(prev => {\n          if (isDuplicateIngredient(newIngredient!.name, prev)) {\n            console.log(`Skipping duplicate ingredient: ${newIngredient!.name}`);\n            return prev;\n          }\n          return [newIngredient!, ...prev];\n        });\n\n        // Send function response back to Cooking Agent\n        await sendMessage([{\n          functionResponse: {\n            name: actionName,\n            response: {\n              success: true,\n              result: newIngredient.name,\n              emoji: newIngredient.emoji,\n              inventory_updated: true\n            }\n          }\n        }]);\n\n      } catch (error) {\n        console.error('Error handling cooking action:', error);\n        setTimeline(prev => prev.map(entry =>\n          entry.id === timelineId\n            ? { ...entry, result: { name: 'error', emoji: '\u274c' } }\n            : entry\n        ));\n\n        // Send error response\n        await sendMessage([{\n          functionResponse: {\n            name: actionName,\n            response: { success: false, error: String(error) }\n          }\n        }]);\n      } finally {\n        setActiveAction(null);\n        setActiveIngredients(new Set());\n      }\n    };\n\n    // Subscribe to function call events\n    (client as any).on('approvedfunctioncalls', handleApprovedFunctionCalls);\n    return () => {\n      (client as any).off('approvedfunctioncalls', handleApprovedFunctionCalls);\n    };\n  }, [client, sendMessage, setTimeline, setActiveAction, setActionTriggerCount, setActiveIngredients, setInventory, executeCombinationRef, onServe, onPass, inventory]);\n\n  // Expose sendMessage function via ref for external triggering\n  useEffect(() => {\n    sendMessageRef.current = async (message: string) => {\n      await sendMessage([{ text: message }]);\n    };\n    return () => {\n      sendMessageRef.current = null;\n    };\n  }, [sendMessage, sendMessageRef]);\n\n  // This component doesn't render anything - it just handles the Cooking Agent logic\n  return null;\n}\n\n// ============================================================================\n// Verification Agent Component (Layer 3)\n// ============================================================================\n\ninterface VerificationAgentProps {\n  orders: Order[];\n  inventory: Ingredient[];\n  setOrders: React.Dispatch<React.SetStateAction<Order[]>>;\n  setTimeline: React.Dispatch<React.SetStateAction<TimelineEntry[]>>;\n  verifyServedDishRef: React.MutableRefObject<((servedDishName: string) => Promise<boolean>) | null>;\n}\n\nfunction VerificationAgent({\n  orders,\n  inventory,\n  setOrders,\n  setTimeline,\n  verifyServedDishRef,\n}: VerificationAgentProps) {\n  const { generateContent, setConfig } = useGeminiAPIContext();\n\n  // Use refs to always access the current values (avoids stale closure)\n  const ordersRef = useRef(orders);\n  const inventoryRef = useRef(inventory);\n  useEffect(() => {\n    ordersRef.current = orders;\n  }, [orders]);\n  useEffect(() => {\n    inventoryRef.current = inventory;\n  }, [inventory]);\n\n  // Set config on mount\n  useEffect(() => {\n    setConfig({\n      systemInstruction: VERIFICATION_SYSTEM_INSTRUCTION,\n      responseMimeType: 'application/json',\n      responseSchema: VERIFICATION_RESPONSE_SCHEMA,\n      thinkingConfig: {\n        thinkingBudget: 0,\n      },\n    });\n  }, [setConfig]);\n\n  // Expose verification function via ref\n  useEffect(() => {\n    verifyServedDishRef.current = async (servedDishName: string) => {\n      // Use ref to get current orders (avoids stale closure)\n      const currentOrders = ordersRef.current;\n\n      // Find in_progress orders to check against\n      const inProgressOrders = currentOrders.filter(o => o.status === 'in_progress');\n\n      if (inProgressOrders.length === 0) {\n        // No active order - return success without running verification\n        setTimeline(prev => [...prev, {\n          id: `verify-noorder-${Date.now()}`,\n          type: 'text' as const,\n          action: '',\n          ingredients: [],\n          result: null,\n          text: `\u2705 Served \"${servedDishName}\" (no active order)`,\n          timestamp: new Date(),\n        }]);\n        return true; // Success, but no order to verify against\n      }\n\n      // Check each pending order for a match\n      for (const order of inProgressOrders) {\n        try {\n          const prompt = `Order: \"${order.name}\"\\nServed dish: \"${servedDishName}\"\\n\\nDoes this served dish match the order?`;\n\n          const contents: Content[] = [\n            { role: 'user', parts: [{ text: prompt }] }\n          ];\n\n          const response = await generateContent(contents);\n          const text = response?.text || '{}';\n          const result: VerificationResult = JSON.parse(text);\n\n          if (result.matches && result.confidence > 0.7) {\n            // Look up the emoji from inventory for the served dish\n            const servedIngredient = findIngredientInInventory(servedDishName, inventoryRef.current);\n            const servedEmoji = servedIngredient?.emoji || '\u2705';\n\n            // Match found! Update order to completed with the served dish's emoji\n            setOrders(prev => prev.map(o =>\n              o.id === order.id\n                ? { ...o, status: 'completed' as const, emoji: servedEmoji }\n                : o\n            ));\n\n            // Add success to timeline\n            setTimeline(prev => [...prev, {\n              id: `verify-${Date.now()}`,\n              type: 'text' as const,\n              action: '',\n              ingredients: [],\n              result: null,\n              text: `\u2705 Correct!`,\n              timestamp: new Date(),\n            }]);\n\n            return true; // Found a match, return success\n          }\n        } catch (error) {\n          console.error('Error verifying order:', error);\n        }\n      }\n\n      // No match found - keep order in_progress so model can try again\n      // Add failure to timeline\n      setTimeline(prev => [...prev, {\n        id: `verify-fail-${Date.now()}`,\n        type: 'text' as const,\n        action: '',\n        ingredients: [],\n        result: null,\n        text: `\u274c Incorrect: \"${servedDishName}\" doesn't match \"${inProgressOrders[0].name}\"`,\n        timestamp: new Date(),\n      }]);\n\n      return false; // No match found, but order stays active\n    };\n\n    return () => {\n      verifyServedDishRef.current = null;\n    };\n  }, [generateContent, setOrders, setTimeline, verifyServedDishRef]);\n\n  // This component doesn't render anything\n  return null;\n}\n\n// ============================================================================\n// Kitchen App Container (Shared State)\n// ============================================================================\n\nfunction KitchenAppContainer() {\n  // Shared state lifted up to be accessible by both agents\n  const [inventory, setInventory] = useState<Ingredient[]>(STARTING_INGREDIENTS);\n  const [selectedIngredients, setSelectedIngredients] = useState<Set<string>>(\n    new Set(PRESELECTED_INGREDIENTS)\n  );\n  const [timeline, setTimeline] = useState<TimelineEntry[]>([]);\n  const [activeAction, setActiveAction] = useState<string | null>(null);\n  const [actionTriggerCount, setActionTriggerCount] = useState(0);\n  const [activeIngredients, setActiveIngredients] = useState<Set<string>>(new Set());\n  const [orders, setOrders] = useState<Order[]>(EXAMPLE_ORDERS);\n\n  // Overlay open states - start closed\n  const [combinationAgentOpen, setCombinationAgentOpen] = useState(false);\n  const [cookingAgentOpen, setCookingAgentOpen] = useState(false);\n  const [verificationAgentOpen, setVerificationAgentOpen] = useState(false);\n\n  // Cooking state - track if the cooking agent is actively working\n  const [isCooking, setIsCooking] = useState(false);\n\n  // Ref to share the Combination Agent's execute function\n  const executeCombinationRef = useRef<((action: KitchenAction, ingredients: string[]) => Promise<Ingredient | null>) | null>(null);\n\n  // Ref to trigger cooking agent from order buttons\n  const sendCookingMessageRef = useRef<((message: string) => void) | null>(null);\n\n  // Ref to trigger verification agent\n  const verifyServedDishRef = useRef<((servedDishName: string) => Promise<boolean>) | null>(null);\n\n  // Callback for \"Cook with Gemini\" button - also opens Cooking Agent overlay (except on mobile)\n  const handleCookWithGemini = useCallback((orderName: string) => {\n    setIsCooking(true); // Set cooking state immediately\n    // Open Cooking Agent and close others (only one agent window at a time)\n    // Skip auto-opening on mobile to avoid obscuring the main UI\n    const isMobile = window.innerWidth < 600;\n    if (!isMobile) {\n      setCookingAgentOpen(true);\n      setCombinationAgentOpen(false);\n      setVerificationAgentOpen(false);\n    }\n    if (sendCookingMessageRef.current) {\n      sendCookingMessageRef.current(`Please prepare: ${orderName}`);\n    }\n  }, []);\n\n  // Verification callback - called when serve() is invoked, returns success/failure\n  const handleVerifyServedDish = useCallback(async (servedDishName: string): Promise<boolean> => {\n    if (verifyServedDishRef.current) {\n      const result = await verifyServedDishRef.current(servedDishName);\n      setIsCooking(false); // Clear cooking state after verification\n      return result;\n    }\n    setIsCooking(false);\n    return false;\n  }, []);\n\n  // Callback for adding a new custom order\n  const handleAddOrder = useCallback((orderName: string) => {\n    const newOrder: Order = {\n      id: `order-${Date.now()}`,\n      name: orderName,\n      emoji: '\ud83d\udccb', // Empty notepad emoji for new orders\n      status: 'not_started',\n    };\n    // Deselect any in_progress or failed orders, then add the new one\n    setOrders(prev => [\n      ...prev.map(order =>\n        order.status === 'in_progress' || order.status === 'failed'\n          ? { ...order, status: order.status === 'in_progress' ? 'not_started' as const : order.status }\n          : order\n      ),\n      newOrder\n    ]);\n  }, []);\n\n  // Callback for picking up an order (changes to in_progress)\n  const handlePickUp = useCallback((orderId: string) => {\n    setOrders(prev => prev.map(order => {\n      // The order being picked up becomes in_progress\n      if (order.id === orderId) {\n        return { ...order, status: 'in_progress' as const };\n      }\n      // Any other in_progress order gets reset to not_started\n      if (order.status === 'in_progress') {\n        return { ...order, status: 'not_started' as const };\n      }\n      return order;\n    }));\n  }, []);\n\n  // Callback for passing on an order (marks it as failed)\n  const handlePass = useCallback(() => {\n    setOrders(prev => prev.map(order =>\n      order.status === 'in_progress'\n        ? { ...order, status: 'failed' as const, servedDish: 'Gave up' }\n        : order\n    ));\n  }, []);\n\n  return (\n    <div className=\"app-container\">\n      {/* Combination Agent (Layer 1) - for manual cooking */}\n      <GeminiAPIProvider>\n        <CombinationAgent\n          inventory={inventory}\n          setInventory={setInventory}\n          timeline={timeline}\n          setTimeline={setTimeline}\n          selectedIngredients={selectedIngredients}\n          setSelectedIngredients={setSelectedIngredients}\n          activeAction={activeAction}\n          setActiveAction={setActiveAction}\n          actionTriggerCount={actionTriggerCount}\n          activeIngredients={activeIngredients}\n          setActiveIngredients={setActiveIngredients}\n          onExecuteActionRef={executeCombinationRef}\n          orders={orders}\n          onCookWithGemini={handleCookWithGemini}\n          onPickUp={handlePickUp}\n          onAddOrder={handleAddOrder}\n          onServe={handleVerifyServedDish}\n          onOpenCombinationAgent={() => {\n            setCombinationAgentOpen(true);\n            setCookingAgentOpen(false);\n            setVerificationAgentOpen(false);\n          }}\n          onOpenCookingAgent={() => {\n            setCookingAgentOpen(true);\n            setCombinationAgentOpen(false);\n            setVerificationAgentOpen(false);\n          }}\n          onOpenVerificationAgent={() => {\n            setVerificationAgentOpen(true);\n            setCombinationAgentOpen(false);\n            setCookingAgentOpen(false);\n          }}\n          isCooking={isCooking}\n          isCookingAgentOpen={cookingAgentOpen}\n          isAlchemyAgentOpen={combinationAgentOpen}\n          isJudgeAgentOpen={verificationAgentOpen}\n        />\n        <GeminiDebug\n          agentName=\"Alchemy Agent\"\n          isOpen={combinationAgentOpen}\n          onClose={() => setCombinationAgentOpen(false)}\n          welcomeMessage=\"I determine the result of cooking actions. I can't see the open orders, so I don't always return what you expect! Select an ingredient + tool to see me work!\"\n          placeholder=\"Ask about ingredient combinations...\"\n          showApprovalSelector={false}\n        />\n      </GeminiAPIProvider>\n\n      {/* Cooking Agent (Layer 2) - for automated cooking via debug console */}\n      <GeminiAPIProvider>\n        <CookingAgent\n          inventory={inventory}\n          setInventory={setInventory}\n          setTimeline={setTimeline}\n          setActiveAction={setActiveAction}\n          setActionTriggerCount={setActionTriggerCount}\n          setActiveIngredients={setActiveIngredients}\n          executeCombinationRef={executeCombinationRef}\n          sendMessageRef={sendCookingMessageRef}\n          onServe={handleVerifyServedDish}\n          onPass={handlePass}\n        />\n        <GeminiDebug\n          agentName=\"Cooking Agent\"\n          isOpen={cookingAgentOpen}\n          onClose={() => setCookingAgentOpen(false)}\n          welcomeMessage=\"I cook with function calls. Click 'Start cooking' to start an order, or type a dish!\"\n          placeholder=\"Type a dish to cook...\"\n          initialAutoApprove={true}\n          showApprovalSelector={true}\n        />\n      </GeminiAPIProvider>\n\n      {/* Verification Agent (Layer 3) - for checking served dishes */}\n      <GeminiAPIProvider>\n        <VerificationAgent\n          orders={orders}\n          inventory={inventory}\n          setOrders={setOrders}\n          setTimeline={setTimeline}\n          verifyServedDishRef={verifyServedDishRef}\n        />\n        <GeminiDebug\n          agentName=\"Judge Agent\"\n          isOpen={verificationAgentOpen}\n          onClose={() => setVerificationAgentOpen(false)}\n          welcomeMessage=\"I verify if served dishes match pending orders. I'm triggered automatically when a dish is served.\"\n          placeholder=\"Ask about order verification...\"\n          showApprovalSelector={false}\n        />\n      </GeminiAPIProvider>\n\n      {/* Attribution Footer */}\n      <footer className=\"attribution-footer\">\n        Ideas/feedback:{' '}\n        <a href=\"https://x.com/cobley_ben\" target=\"_blank\" rel=\"noopener noreferrer\">\n          cobley_ben@\n        </a>\n      </footer>\n    </div>\n  );\n}\n\n// ============================================================================\n// App Component\n// ============================================================================\n\nfunction App() {\n  return <KitchenAppContainer />;\n}\n\nexport default App;\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 49837,
      "order": 3
    },
    {
      "path": "README.md",
      "content": "<div align=\"center\">\n<img width=\"1200\" height=\"475\" alt=\"GHBanner\" src=\"https://github.com/user-attachments/assets/0aa67016-6eaf-458a-adb2-6e31a0763ed6\" />\n</div>\n\n# Run and deploy your AI Studio app\n\nThis contains everything you need to run your app locally.\n\nView your app in AI Studio: https://ai.studio/apps/bundled/function_call_kitchen\n\n## Run Locally\n\n**Prerequisites:**  Node.js\n\n\n1. Install dependencies:\n   `npm install`\n2. Set the `GEMINI_API_KEY` in [.env.local](.env.local) to your Gemini API key\n3. Run the app:\n   `npm run dev`\n",
      "role": "COMPONENT",
      "language": "markdown",
      "size": 543,
      "order": 4
    },
    {
      "path": "constants.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * 100 Tools Kitchen App - Constants and Types\n */\n\nimport { Type } from '@google/genai';\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface Ingredient {\n  name: string;\n  emoji: string;\n}\n\nexport interface KitchenAction {\n  name: string;           // Function name (alphanumeric + underscores)\n  displayName: string;    // Human-readable name\n  emoji: string;\n}\n\nexport interface CombinationResult {\n  result_name: string;\n  emoji: string;\n}\n\nexport interface TimelineEntry {\n  id: string;\n  timestamp: Date;\n  // Text from model response (shown above/below action)\n  text?: string;\n  // Action from function call\n  action?: string;\n  ingredients?: string[];\n  result?: Ingredient | null;  // null when loading\n}\n\nexport type OrderDifficulty = 'easy' | 'intermediate' | 'difficult';\n\nexport interface Order {\n  id: string;\n  name: string;\n  emoji: string;\n  difficulty: OrderDifficulty;\n  status: 'not_started' | 'in_progress' | 'completed' | 'failed';\n  servedDish?: string;  // What was actually served (for failed orders)\n}\n\nexport interface VerificationResult {\n  matches: boolean;\n  confidence: number;\n  explanation: string;\n}\n\nexport const EXAMPLE_ORDERS: Order[] = [\n  { id: 'order-1', name: 'Fried Eggs', emoji: '\ud83c\udf73', difficulty: 'easy', status: 'not_started' },\n  { id: 'order-2', name: 'Tonkotsu Ramen', emoji: '\ud83c\udf5c', difficulty: 'intermediate', status: 'not_started' },\n  { id: 'order-3', name: 'Itek Tim', emoji: '\ud83c\udf72', difficulty: 'difficult', status: 'not_started' },\n];\n\n// ============================================================================\n// Helper Functions\n// ============================================================================\n\n/** Sanitize action name for function declarations: \"deep fry\" \u2192 \"deep_fry\" */\nexport function sanitizeName(name: string): string {\n  return name.replace(/\\s+/g, '_').replace(/[^a-zA-Z0-9_]/g, '');\n}\n\n/** Create KitchenAction from simple tool definition */\nfunction createAction(name: string, emoji: string): KitchenAction {\n  return {\n    name: sanitizeName(name),\n    displayName: name,\n    emoji,\n  };\n}\n\n// ============================================================================\n// Cooking Actions\n// ============================================================================\n\nexport const COOKING_ACTIONS: KitchenAction[] = [\n  // Basic Cooking Methods\n  createAction('fry', '\ud83c\udf73'), createAction('boil', '\ud83e\udee7'), createAction('bake', '\ud83e\udd6f'),\n  createAction('saute', '\ud83e\udd58'), createAction('grill', '\ud83e\udd69'), createAction('steam', '\ud83e\udd5f'),\n  createAction('roast', '\ud83c\udf57'), createAction('simmer', '\ud83c\udf72'), createAction('broil', '\ud83c\udf21\ufe0f'),\n  createAction('poach', '\ud83e\udd5a'), createAction('braise', '\ud83e\udd58'), createAction('stew', '\ud83c\udf72'),\n  createAction('sear', '\ud83c\udf73'), createAction('deep fry', '\ud83c\udf5f'),\n  createAction('sous vide', '\ud83d\udec1'), createAction('air fry', '\ud83c\udf2c\ufe0f'), createAction('microwave', '\u2622\ufe0f'),\n  createAction('wok', '\ud83e\udd61'), createAction('char', '\ud83d\udd25'), createAction('torch', '\ud83d\udd25'),\n  createAction('plancha', '\ud83d\udd25'), createAction('sweat', '\ud83d\udca6'), createAction('parboil', '\ud83e\udee7'),\n\n  // Preparation Methods\n  createAction('chop', '\ud83d\udd2a'), createAction('dice', '\ud83d\udd2a'), createAction('slice', '\ud83d\udd2a'),\n  createAction('mince', '\ud83d\udd2a'), createAction('julienne', '\ud83d\udd2a'), createAction('grate', '\ud83e\uddc0'),\n  createAction('peel', '\ud83e\udd54'), createAction('core', '\ud83c\udf4e'), createAction('pit', '\ud83e\udd51'),\n  createAction('trim', '\u2702\ufe0f'), createAction('clean', '\ud83e\uddfd'), createAction('wash', '\ud83d\udca7'),\n\n  // Mixing & Combining\n  createAction('mix', '\ud83e\udd63'), createAction('whisk', '\ud83e\udd44'), createAction('stir', '\ud83e\udd44'),\n  createAction('fold', '\ud83e\udd44'), createAction('beat', '\ud83e\udd44'), createAction('whip', '\ud83e\udd44'),\n  createAction('blend', '\ud83c\udf2a\ufe0f'), createAction('combine', '\ud83e\udd63'), createAction('toss', '\ud83e\udd57'),\n\n  // Seasoning & Flavoring\n  createAction('marinate', '\ud83c\udf56'), createAction('brine', '\ud83e\uddc2'),\n  createAction('cure', '\ud83e\udd53'), createAction('smoke', '\ud83d\udca8'), createAction('pickle', '\ud83e\udd52'),\n  createAction('ferment', '\ud83e\uded9'), createAction('infuse', '\ud83c\udf75'), createAction('steep', '\ud83e\uded6'),\n\n  // Advanced Techniques\n  createAction('caramelize', '\ud83c\udf6f'), createAction('flambe', '\ud83d\udd25'), createAction('reduce', '\ud83c\udf72'),\n  createAction('emulsify', '\ud83e\udd44'), createAction('temper', '\ud83c\udf6b'), createAction('proof', '\ud83c\udf5e'),\n  createAction('rise', '\ud83c\udf5e'), createAction('rest', '\u23f0'), createAction('chill', '\u2744\ufe0f'),\n  createAction('freeze', '\ud83e\uddca'), createAction('thaw', '\ud83d\udca7'), createAction('melt', '\ud83e\udee0'),\n  createAction('clarify', '\u2728'), createAction('deglaze', '\ud83c\udf77'), createAction('velvet', '\ud83e\udd62'),\n  createAction('age', '\ud83e\udd69'),\n\n  // Baking & Pastry\n  createAction('knead', '\ud83c\udf5e'), createAction('roll', '\ud83e\udd56'), createAction('sift', '\ud83c\udf28\ufe0f'),\n  createAction('grease', '\ud83e\uddc8'), createAction('dust', '\ud83c\udf28\ufe0f'), createAction('glaze', '\ud83c\udf69'),\n  createAction('pipe', '\ud83e\uddc1'), createAction('score', '\ud83d\udd2a'), createAction('batter', '\ud83e\udd5b'),\n  createAction('bread', '\ud83c\udf5e'),\n\n  // Other Techniques\n  createAction('strain', '\ud83d\udca7'), createAction('mash', '\ud83e\udd54'),\n  createAction('puree', '\ud83e\udd63'), createAction('crush', '\ud83d\udd28'), createAction('grind', '\u2699\ufe0f'),\n  createAction('shred', '\ud83e\uddc0'), createAction('zest', '\ud83c\udf4b'), createAction('juice', '\ud83c\udf4a'),\n  createAction('baste', '\ud83e\udd44'), createAction('blanch', '\ud83e\udd66'), createAction('pull', '\ud83e\uddf2'),\n\n  // Prep\n  createAction('tenderize', '\ud83d\udd28'), createAction('stuff', '\ud83e\udd83'),\n  createAction('wrap', '\ud83c\udf2f'), createAction('skewer', '\ud83c\udf62'), createAction('crack', '\ud83e\udd5a'),\n  createAction('flatten', '\ud83d\udd28'), createAction('debone', '\ud83e\uddb4'), createAction('fillet', '\ud83d\udc1f'),\n  createAction('garnish', '\ud83c\udf3f'),\n\n  // Serving/Finishing\n  createAction('serve', '\ud83c\udf7d\ufe0f'), createAction('pass', '\ud83c\udff3\ufe0f'),\n];\n\n// ============================================================================\n// Starting Ingredients \n// ============================================================================\n\nexport const STARTING_INGREDIENTS: Ingredient[] = [\n  // Proteins\n  { name: 'chicken', emoji: '\ud83d\udc14' }, { name: 'beef', emoji: '\ud83e\udd69' }, { name: 'pork', emoji: '\ud83d\udc37' },\n  { name: 'fish', emoji: '\ud83d\udc1f' }, { name: 'salmon', emoji: '\ud83c\udf63' }, { name: 'shrimp', emoji: '\ud83e\udd90' },\n  { name: 'eggs', emoji: '\ud83e\udd5a' }, { name: 'tofu', emoji: '\ud83e\uddc8' }, { name: 'beans', emoji: '\ud83e\uded8' },\n  { name: 'lentils', emoji: '\ud83e\uded8' }, { name: 'turkey', emoji: '\ud83e\udd83' }, { name: 'lamb', emoji: '\ud83d\udc11' },\n  { name: 'duck', emoji: '\ud83e\udd86' },\n\n  // Dairy\n  { name: 'milk', emoji: '\ud83e\udd5b' }, { name: 'butter', emoji: '\ud83e\uddc8' }, { name: 'cheese', emoji: '\ud83e\uddc0' },\n  { name: 'cream', emoji: '\ud83e\udd5b' }, { name: 'yogurt', emoji: '\ud83e\udd5b' }, { name: 'sour cream', emoji: '\ud83e\udd5b' },\n  { name: 'mozzarella', emoji: '\ud83e\uddc0' }, { name: 'parmesan', emoji: '\ud83e\uddc0' }, { name: 'cheddar', emoji: '\ud83e\uddc0' },\n\n  // Grains & Starches\n  { name: 'flour', emoji: '\ud83c\udf3e' }, { name: 'rice', emoji: '\ud83c\udf5a' }, { name: 'pasta', emoji: '\ud83c\udf5d' },\n  { name: 'bread', emoji: '\ud83c\udf5e' }, { name: 'oats', emoji: '\ud83c\udf3e' },\n  { name: 'barley', emoji: '\ud83c\udf3e' }, { name: 'wheat', emoji: '\ud83c\udf3e' }, { name: 'corn', emoji: '\ud83c\udf3d' },\n  { name: 'potatoes', emoji: '\ud83e\udd54' }, { name: 'sweet potato', emoji: '\ud83c\udf60' }, { name: 'noodles', emoji: '\ud83c\udf5c' },\n\n  // Herbs & Spices\n  { name: 'basil', emoji: '\ud83c\udf3f' }, { name: 'oregano', emoji: '\ud83c\udf3f' }, { name: 'thyme', emoji: '\ud83c\udf3f' },\n  { name: 'rosemary', emoji: '\ud83c\udf3f' }, { name: 'parsley', emoji: '\ud83c\udf3f' }, { name: 'cilantro', emoji: '\ud83c\udf3f' },\n  { name: 'salt', emoji: '\ud83e\uddc2' }, { name: 'pepper', emoji: '\ud83c\udf36\ufe0f' }, { name: 'paprika', emoji: '\ud83c\udf36\ufe0f' },\n  { name: 'cumin', emoji: '\ud83c\udf36\ufe0f' }, { name: 'cinnamon', emoji: '\ud83c\udf36\ufe0f' }, { name: 'vanilla', emoji: '\ud83c\udf3f' },\n\n  // Pantry Staples\n  { name: 'olive oil', emoji: '\ud83e\uded2' }, { name: 'vegetable oil', emoji: '\ud83d\udee2\ufe0f' }, { name: 'vinegar', emoji: '\ud83c\udf76' },\n  { name: 'soy sauce', emoji: '\ud83c\udf76' }, { name: 'honey', emoji: '\ud83c\udf6f' }, { name: 'maple syrup', emoji: '\ud83c\udf6f' },\n\n  // Baking\n  { name: 'sugar', emoji: '\ud83c\udf6f' }, { name: 'baking soda', emoji: '\ud83e\udd44' }, { name: 'yeast', emoji: '\ud83c\udf5e' },\n  { name: 'vanilla extract', emoji: '\ud83c\udf3f' }, { name: 'cocoa powder', emoji: '\u2615' }, { name: 'chocolate', emoji: '\ud83c\udf6b' },\n\n  // Nuts & Seeds\n  { name: 'almonds', emoji: '\ud83c\udf30' }, { name: 'walnuts', emoji: '\ud83c\udf30' }, { name: 'pecans', emoji: '\ud83c\udf30' },\n  { name: 'peanuts', emoji: '\ud83e\udd5c' }, { name: 'cashews', emoji: '\ud83c\udf30' }, { name: 'pine nuts', emoji: '\ud83c\udf30' },\n  { name: 'sesame seeds', emoji: '\ud83c\udf30' },\n\n  // Liquids\n  { name: 'water', emoji: '\ud83d\udca7' }, { name: 'broth', emoji: '\ud83c\udf72' }, { name: 'wine', emoji: '\ud83c\udf77' },\n  { name: 'beer', emoji: '\ud83c\udf7a' }, { name: 'coconut milk', emoji: '\ud83e\udd65' }, { name: 'almond milk', emoji: '\ud83c\udf30' },\n\n  // Fruits\n  { name: 'lemon', emoji: '\ud83c\udf4b' }, { name: 'lime', emoji: '\ud83c\udf4b' }, { name: 'orange', emoji: '\ud83c\udf4a' },\n  { name: 'apple', emoji: '\ud83c\udf4e' }, { name: 'banana', emoji: '\ud83c\udf4c' }, { name: 'strawberry', emoji: '\ud83c\udf53' },\n  { name: 'blueberry', emoji: '\ud83e\uded0' }, { name: 'grape', emoji: '\ud83c\udf47' }, { name: 'pineapple', emoji: '\ud83c\udf4d' },\n  { name: 'mango', emoji: '\ud83e\udd6d' }, { name: 'peach', emoji: '\ud83c\udf51' }, { name: 'cherry', emoji: '\ud83c\udf52' },\n\n  // Vegetables\n  { name: 'onion', emoji: '\ud83e\uddc5' }, { name: 'garlic', emoji: '\ud83e\uddc4' }, { name: 'tomato', emoji: '\ud83c\udf45' },\n  { name: 'carrot', emoji: '\ud83e\udd55' }, { name: 'celery', emoji: '\ud83e\udd6c' }, { name: 'bell pepper', emoji: '\ud83e\uded1' },\n  { name: 'mushroom', emoji: '\ud83c\udf44' }, { name: 'spinach', emoji: '\ud83e\udd6c' }, { name: 'lettuce', emoji: '\ud83e\udd6c' },\n  { name: 'broccoli', emoji: '\ud83e\udd66' }, { name: 'cauliflower', emoji: '\ud83e\udd66' }, { name: 'cabbage', emoji: '\ud83e\udd6c' },\n  { name: 'zucchini', emoji: '\ud83e\udd52' }, { name: 'cucumber', emoji: '\ud83e\udd52' }, { name: 'eggplant', emoji: '\ud83c\udf46' },\n  { name: 'avocado', emoji: '\ud83e\udd51' }, { name: 'jalape\u00f1o', emoji: '\ud83c\udf36\ufe0f' }, { name: 'ginger', emoji: '\ud83e\udeda' },\n];\n\n// ============================================================================\n// Preselected Ingredients\n// ============================================================================\n\nexport const PRESELECTED_INGREDIENTS = [];\n\n// ============================================================================\n// Combination Agent Configuration\n// ============================================================================\n\nexport const COMBINATION_SYSTEM_INSTRUCTION = `You are a cooking result generator. Given a cooking action and ingredients, \ndetermine what dish or prepared item results from this combination.\n\nReturn a JSON object with:\n- result_name: The name of the resulting dish or item (1-3 words)\n- emoji: A single emoji that represents the result\n\nBe creative but realistic. The result should make culinary sense.`;\n\nexport const COMBINATION_RESPONSE_SCHEMA = {\n  type: Type.OBJECT,\n  properties: {\n    result_name: { type: Type.STRING },\n    emoji: { type: Type.STRING }\n  },\n  required: ['result_name', 'emoji']\n};\n\n// ============================================================================\n// Verification Agent Configuration\n// ============================================================================\n\nexport const VERIFICATION_SYSTEM_INSTRUCTION = `You are a food verification assistant. \nGiven an order name and a served dish name, determine if they match semantically.\nUse your broad knowledge of foods of the world to make your decision.\n\nThe match should be flexible - for example:\n- \"Pad Thai\" matches \"pad thai\", \"thai stir-fried noodles\", \"peanut noodles\"\n- \"Beef Bourguignon\" matches \"beef bourguignon\", \"french beef stew\", \"burgundy beef\"\n- \"Caesar Salad\" matches \"caesar salad\", \"romaine with caesar dressing\", \"classic caesar\"\n\nReturn a JSON object with:\n- matches: true if the dishes are semantically the same, false otherwise\n- confidence: a number from 0 to 1 indicating your confidence\n- explanation: a brief explanation of your reasoning`;\n\nexport const VERIFICATION_RESPONSE_SCHEMA = {\n  type: Type.OBJECT,\n  properties: {\n    matches: { type: Type.BOOLEAN },\n    confidence: { type: Type.NUMBER },\n    explanation: { type: Type.STRING }\n  },\n  required: ['matches', 'confidence', 'explanation']\n};\n\n// ============================================================================\n// Cooking Agent Configuration (Phase 2)\n// ============================================================================\n\n/** Generate function declarations for all cooking actions */\nexport function generateCookingTools() {\n  const functionDeclarations = COOKING_ACTIONS.map(action => {\n    // Special case for 'serve' action - different parameter schema\n    if (action.name === 'serve') {\n      return {\n        name: 'serve',\n        description: `${action.emoji} Serve a dish from the current inventory. The dish parameter must be an exact item name from the inventory.`,\n        parameters: {\n          type: Type.OBJECT,\n          properties: {\n            dish: {\n              type: Type.STRING,\n              description: 'Name of dish being served (must be an exact item name from inventory)'\n            }\n          },\n          required: ['dish']\n        }\n      };\n    }\n\n    // Special case for 'pass' action - give up on an order\n    if (action.name === 'pass') {\n      return {\n        name: 'pass',\n        description: `${action.emoji} Pass on the current challenge. Use this after trying to serve the dish with available ingredients or tools (at least 3 times).`,\n        parameters: {\n          type: Type.OBJECT,\n          properties: {},\n          required: []\n        }\n      };\n    }\n\n    // Standard cooking action\n    return {\n      name: action.name,\n      description: `${action.emoji} Apply the '${action.displayName}' cooking technique.`,\n      parameters: {\n        type: Type.OBJECT,\n        properties: {\n          ingredients: {\n            type: Type.ARRAY,\n            items: { type: Type.STRING },\n            description: 'Ingredient names (must exist in inventory)'\n          }\n        },\n        required: ['ingredients']\n      }\n    };\n  });\n\n  // Return as Tool[] format\n  return [{ functionDeclarations }] as any;\n}\n\n/** Build Cooking Agent system instruction with current inventory */\nexport function buildCookingAgentSystemInstruction(inventory: Ingredient[]): string {\n  const actionList = COOKING_ACTIONS.map(a => `${a.emoji} ${a.name}()`).join(', ');\n  const inventoryList = inventory.map(i => `${i.emoji} ${i.name}`).join(', ');\n\n  return `You are a creative chef assistant that can prepare any dish using cooking actions.\n\n**Available Cooking Actions:**\n${actionList}\n\n**Your Task:**\nWhen the user requests a dish, plan and execute cooking steps using function calls. \nExplain your reasoning in one short sentence, then call a cooking function. \n\n**CRITICAL: ONE FUNCTION CALL PER TURN**\nYou MUST call exactly ONE function per response. After each function call, \nwait for the result before calling the next function.\n\n**Important Rules:**\n- Only use ingredients that exist in the current inventory\n- Each cooking action produces new items added to inventory\n- Call serve() when the target dish is ready. I then confirm with a friendly message!\n- If serve() returns a success, confirm with a friendly message!\n- If serve() returns a failure, explain why and try again!\n- Call pass() if you cannot complete the order with the available ingredients or tools. This gives up on the current order.\n\n**Current Inventory:**\n${inventoryList}\n\nBe creative but realistic about cooking steps!`;\n}\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 14961,
      "order": 5
    },
    {
      "path": "index.css",
      "content": "body {\n  margin: 0;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\ncode {\n  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',\n    monospace;\n}\n",
      "role": "STYLE",
      "language": "css",
      "size": 366,
      "order": 6
    },
    {
      "path": "index.html",
      "content": "<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n    <title>Gemini Web Console</title>\n    <link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap\" />\n    <link rel=\"stylesheet\" href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=block\" />\n    <link href=\"https://fonts.googleapis.com/css2?family=Google+Sans+Flex:slnt,wdth,ROND@-10..0,25..151,0..100&display=swap\" rel=\"stylesheet\" />\n    <link href=\"https://fonts.googleapis.com/css2?family=Google+Sans+Mono:ital,wght@0,1..1000;1,1..1000&display=swap\" rel=\"stylesheet\" />\n    <script type=\"importmap\">\n{\n  \"imports\": {\n    \"react\": \"https://esm.sh/react@^19.2.0\",\n    \"react/\": \"https://esm.sh/react@^19.2.0/\",\n    \"react-dom\": \"https://esm.sh/react-dom@^19.2.0\",\n    \"react-dom/\": \"https://esm.sh/react-dom@^19.2.0/\",\n    \"@google/genai\": \"https://esm.sh/@google/genai@^1.30.0\",\n    \"zustand\": \"https://esm.sh/zustand@^5.0.8\",\n    \"zustand/\": \"https://esm.sh/zustand@^5.0.8/\",\n    \"classnames\": \"https://esm.sh/classnames@^2.5.1\",\n    \"eventemitter3\": \"https://esm.sh/eventemitter3@^5.0.1\",\n    \"react-select\": \"https://esm.sh/react-select@^5.10.2\",\n    \"react-syntax-highlighter\": \"https://esm.sh/react-syntax-highlighter@^16.1.0\",\n    \"react-syntax-highlighter/\": \"https://esm.sh/react-syntax-highlighter@^16.1.0/\",\n    \"lodash\": \"https://esm.sh/lodash@^4.17.21\",\n    \"three/\": \"https://esm.sh/three@^0.182.0/\",\n    \"three\": \"https://esm.sh/three@^0.182.0\",\n    \"tone\": \"https://esm.sh/tone@^15.1.22\"\n  }\n}\n</script>\n  <link rel=\"stylesheet\" href=\"/index.css\">\n</head>\n  <body>\n    <div id=\"root\"></div>\n    <script type=\"module\" src=\"./index.tsx\"></script>\n  <script type=\"module\" src=\"/index.tsx\"></script>\n</body>\n</html>\n",
      "role": "COMPONENT",
      "language": "html",
      "size": 1927,
      "order": 7
    },
    {
      "path": "index.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\n\nconst root = ReactDOM.createRoot(\n  document.getElementById('root') as HTMLElement\n);\nroot.render(\n  // <React.StrictMode>\n    <App />\n  // </React.StrictMode>\n);\n",
      "role": "ENTRY",
      "language": "typescript",
      "size": 934,
      "order": 8
    },
    {
      "path": "metadata.json",
      "content": "{\n  \"description\": \"Gemini 3 Flash controls 100 tools in a simulated kitchen.\",\n  \"requestFramePermissions\": [\n    \"camera\",\n    \"microphone\"\n  ],\n  \"name\": \"Function Call Kitchen\"\n}",
      "role": "COMPONENT",
      "language": "json",
      "size": 182,
      "order": 9
    },
    {
      "path": "package.json",
      "content": "{\n  \"name\": \"function-call-kitchen\",\n  \"private\": true,\n  \"version\": \"0.0.0\",\n  \"type\": \"module\",\n  \"scripts\": {\n    \"dev\": \"vite\",\n    \"build\": \"vite build\",\n    \"preview\": \"vite preview\"\n  },\n  \"dependencies\": {\n    \"react\": \"^19.2.0\",\n    \"react-dom\": \"^19.2.0\",\n    \"@google/genai\": \"^1.30.0\",\n    \"zustand\": \"^5.0.8\",\n    \"classnames\": \"^2.5.1\",\n    \"eventemitter3\": \"^5.0.1\",\n    \"react-select\": \"^5.10.2\",\n    \"react-syntax-highlighter\": \"^16.1.0\",\n    \"lodash\": \"^4.17.21\",\n    \"three\": \"^0.182.0\",\n    \"tone\": \"^15.1.22\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"^22.14.0\",\n    \"@vitejs/plugin-react\": \"^5.0.0\",\n    \"typescript\": \"~5.8.2\",\n    \"vite\": \"^6.2.0\"\n  }\n}\n",
      "role": "CONFIG",
      "language": "json",
      "size": 682,
      "order": 10
    },
    {
      "path": "tsconfig.json",
      "content": "{\n  \"compilerOptions\": {\n    \"target\": \"ES2022\",\n    \"experimentalDecorators\": true,\n    \"useDefineForClassFields\": false,\n    \"module\": \"ESNext\",\n    \"lib\": [\n      \"ES2022\",\n      \"DOM\",\n      \"DOM.Iterable\"\n    ],\n    \"skipLibCheck\": true,\n    \"types\": [\n      \"node\"\n    ],\n    \"moduleResolution\": \"bundler\",\n    \"isolatedModules\": true,\n    \"moduleDetection\": \"force\",\n    \"allowJs\": true,\n    \"jsx\": \"react-jsx\",\n    \"paths\": {\n      \"@/*\": [\n        \"./*\"\n      ]\n    },\n    \"allowImportingTsExtensions\": true,\n    \"noEmit\": true\n  }\n}",
      "role": "CONFIG",
      "language": "json",
      "size": 542,
      "order": 11
    },
    {
      "path": "types.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GoogleGenAIOptions } from \"@google/genai\";\nimport { GeminiLoggerType } from \"./gemini/lib/gemini-log-filters\";\n\n// ===== Client Options =====\n\n/**\n * the options to initiate the client, ensure apiKey is required\n */\nexport type GeminiClientOptions = GoogleGenAIOptions & { apiKey: string };\n\n// ===== Log Types =====\n\n// Log direction\nexport type LogDirection = \"send\" | \"receive\" | \"internal\";\n\n// Shared app events (both APIs use these)\nexport type SharedAppLogEventType =\n  | \"app-set-model\"\n  | \"app-set-config\"\n  | \"app-set-placeholder\"\n  | \"app-set-welcome\";\n\n// Core API events - maps to genai client methods\nexport type GeminiLogEventType =\n  | \"generate-content\" // generateContent request/response\n  | \"generate-content-stream\" // generateContentStream chunks\n  | \"send-message\" // chat.sendMessage request/response\n  | \"send-message-stream\" // chat.sendMessageStream chunks\n  | \"function-call\" // detected function calls in response\n  | \"function-response\" // function responses in next request\n  // Core-specific app events for function approval\n  | \"app-review-functions\" // user needs to approve\n  | \"app-approve-functions\" // user approved\n  | \"app-reject-functions\"; // user rejected\n\nexport type GeminiLogEvent = {\n  date: Date;\n  direction: LogDirection;\n  type: GeminiLogEventType | SharedAppLogEventType;\n  message: any;\n  count?: number;\n};\n\n// ===== Console Display Types =====\n\nexport type DisplayMode = \"overlay\" | \"inline\";\n\nexport type OverlayPosition = \"side\" | \"fullscreen\" | \"minimized\";\n\nexport type LogStyle = \"console\" | \"chat\" | \"plaintext\";\n\n// ===== Console Props =====\n\nexport type GeminiCustomConsoleProps = {\n  agentName?: string;\n\n  // Display\n  displayMode?: DisplayMode;\n  initialOverlayPosition?: OverlayPosition;\n  enableOverlayPositionSelector?: boolean;\n\n  // Visibility toggles\n  showInput?: boolean;\n  showLogger?: boolean;\n  showApprovalSelector?: boolean;\n  showModelSelector?: boolean;\n\n  // Logger settings\n  enableLogStyleSelector?: boolean;\n  initialLogStyle?: LogStyle;\n  enableLogFilterSelector?: boolean;\n  initialLogFilter?: GeminiLoggerType;\n\n  // Connection\n  autoConnect?: boolean;\n\n  // Content customization\n  welcomeMessage?: string;\n  placeholder?: string;\n  initialAutoApprove?: boolean;\n};\n\n// ===== Console Option Arrays =====\n\nexport const logStyleOptions = [\n  { value: \"console\" as const, label: \"Console view\" },\n  { value: \"chat\" as const, label: \"Chat view\" },\n  { value: \"plaintext\" as const, label: \"Plaintext view\" },\n];\n\nexport const voiceOptions = [\n  { value: \"Puck\", label: \"Puck\" },\n  { value: \"Charon\", label: \"Charon\" },\n  { value: \"Kore\", label: \"Kore\" },\n  { value: \"Fenrir\", label: \"Fenrir\" },\n  { value: \"Aoede\", label: \"Aoede\" },\n];\n\nexport const responseModalityOptions = [\n  { value: \"audio\" as const, label: \"Audio\" },\n  { value: \"text\" as const, label: \"Text\" },\n];\n\nexport const modelOptions = [\n  { value: \"gemini-3-flash-preview\", label: \"Gemini 3 Flash\" },\n  { value: \"gemini-3-pro-preview\", label: \"Gemini 3 Pro\" },\n];\n\nexport const functionApprovalOptions = [\n  { value: \"manual\", label: \"Require approval\" },\n  { value: \"auto\", label: \"Auto approve functions\" },\n];\n",
      "role": "TYPE",
      "language": "typescript",
      "size": 3829,
      "order": 12
    },
    {
      "path": "vite.config.ts",
      "content": "import path from 'path';\nimport { defineConfig, loadEnv } from 'vite';\nimport react from '@vitejs/plugin-react';\n\nexport default defineConfig(({ mode }) => {\n    const env = loadEnv(mode, '.', '');\n    return {\n      server: {\n        port: 3000,\n        host: '0.0.0.0',\n      },\n      plugins: [react()],\n      define: {\n        'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),\n        'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY)\n      },\n      resolve: {\n        alias: {\n          '@': path.resolve(__dirname, '.'),\n        }\n      }\n    };\n});\n",
      "role": "CONFIG",
      "language": "typescript",
      "size": 580,
      "order": 13
    },
    {
      "path": "gemini/components/GeminiChat.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport GeminiCustomConsole from \"./GeminiCustomConsole\";\n\nexport type GeminiChatProps = {\n  agentName?: string;\n};\n\n/**\n * A simplified inline chat component for the Gemini API.\n * Pre-configured with:\n * - Inline display mode (no overlay)\n * - Hidden overlay controls\n * - Hidden logger controls\n * - Input and logger visible\n */\nfunction GeminiChat({ agentName = \"Gemini Chat\" }: GeminiChatProps) {\n  return (\n    <GeminiCustomConsole\n      agentName={agentName}\n      displayMode=\"inline\"\n      enableOverlayPositionSelector={false}\n      showInput={true}\n      showLogger={true}\n      enableLogStyleSelector={false}\n      enableLogFilterSelector={false}\n      initialLogStyle=\"chat\"\n    />\n  );\n}\n\nexport default GeminiChat;\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 1384,
      "order": 14
    },
    {
      "path": "gemini/components/GeminiCustomConsole.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useState, useRef, useEffect, memo, useCallback, MouseEvent as ReactMouseEvent } from \"react\";\nimport cn from \"classnames\";\nimport Select from \"react-select\";\nimport { useGeminiAPIContext } from \"../contexts/GeminiAPIContext\";\nimport { useStore } from \"zustand\";\nimport TypingIndicator from \"./TypingIndicator\";\nimport GeminiLogger from \"./GeminiLogger\";\nimport { coreFilters, GeminiLoggerType } from \"../lib/gemini-log-filters\";\nimport \"../../styles/console.css\";\nimport \"./gemini-custom-console.css\";\n\nimport { createPartFromText } from \"@google/genai\";\nimport {\n  GeminiCustomConsoleProps,\n  OverlayPosition,\n  LogStyle,\n  logStyleOptions,\n  modelOptions,\n  functionApprovalOptions,\n} from \"../../types\";\n\n// Extended props that include open/close control\ninterface GeminiCustomConsoleExtendedProps extends GeminiCustomConsoleProps {\n  isOpen?: boolean;\n  onClose?: () => void;\n}\n\nconst logFilterOptions = Object.keys(coreFilters).map((filter) => ({\n  value: filter as GeminiLoggerType,\n  label: filter === \"all\" ? \"Show all logs\" : filter.charAt(0).toUpperCase() + filter.slice(1),\n}));\n\nfunction GeminiCustomConsole({\n  agentName = \"Core Console\",\n\n  // Display\n  displayMode = \"overlay\",\n  initialOverlayPosition = \"side\",\n  enableOverlayPositionSelector = true,\n\n  // Visibility\n  showInput = true,\n  showLogger = true,\n  showApprovalSelector = true,\n  showModelSelector = true,\n\n  // Logger settings\n  enableLogStyleSelector = true,\n  initialLogStyle = \"console\",\n  enableLogFilterSelector = true,\n  initialLogFilter = \"conversations\",\n\n  // Connection\n  autoConnect = false,\n\n  // Open/close control for external management\n  isOpen = true,\n  onClose,\n\n  // Content customization\n  welcomeMessage,\n  placeholder,\n  initialAutoApprove = false,\n}: GeminiCustomConsoleExtendedProps) {\n  // State\n  const [overlayPosition, setOverlayPosition] = useState<OverlayPosition>(initialOverlayPosition);\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const [logStyle, setLogStyle] = useState<LogStyle>(initialLogStyle); // TODO: Implement log style rendering\n  const [logFilter, setLogFilter] = useState<GeminiLoggerType>(initialLogFilter);\n  const [textInput, setTextInput] = useState(\"\");\n\n  // Drag state for overlay mode\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });\n  const [dragPosition, setDragPosition] = useState<{ x: number; y: number; zIndex: number } | null>(null);\n  const wrapperRef = useRef<HTMLDivElement>(null);\n\n  // Refs\n  const loggerRef = useRef<HTMLDivElement>(null);\n  const inputRef = useRef<HTMLTextAreaElement>(null);\n  const connectButtonRef = useRef<HTMLButtonElement>(null);\n\n  // Context and hooks\n  const {\n    connected,\n    isAwaitingResponse,\n    hasUnreadResponse,\n    clearUnreadResponse,\n    startChat,\n    endChat,\n    sendMessage,\n    loggerStore,\n    model,\n    setModel,\n    setAutoApproveFunctionCalls,\n    setWelcomeMessage,\n  } = useGeminiAPIContext();\n  const logs = useStore(loggerStore, (state) => state.logs);\n\n  // Function approval mode state - initialize from prop\n  const [selectedApprovalMode, setSelectedApprovalMode] = useState(\n    initialAutoApprove ? functionApprovalOptions[1] : functionApprovalOptions[0]\n  );\n\n  // Set initial auto-approve on mount\n  useEffect(() => {\n    if (initialAutoApprove) {\n      setAutoApproveFunctionCalls(true);\n    }\n  }, [initialAutoApprove, setAutoApproveFunctionCalls]);\n\n  // Model selector state\n  const [selectedModel, setSelectedModel] = useState(\n    modelOptions.find((m) => m.value === model) || modelOptions[0]\n  );\n\n  // Update approval mode when selection changes\n  const updateApprovalMode = useCallback(\n    (mode: \"manual\" | \"auto\") => {\n      setAutoApproveFunctionCalls(mode === \"auto\");\n    },\n    [setAutoApproveFunctionCalls]\n  );\n\n  // Update model when selection changes\n  const updateModel = useCallback(\n    (modelValue: string) => {\n      setModel(modelValue);\n    },\n    [setModel]\n  );\n\n  // Focus connect button when disconnected\n  useEffect(() => {\n    if (!connected && connectButtonRef.current) {\n      connectButtonRef.current.focus();\n    }\n  }, [connected]);\n\n  // Auto-connect on mount if enabled, and log welcome message\n  useEffect(() => {\n    if (autoConnect) {\n      if (welcomeMessage) {\n        setWelcomeMessage(welcomeMessage);\n      }\n      startChat();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []); // Only run on mount\n\n  // Auto-scroll log to bottom\n  useEffect(() => {\n    if (loggerRef.current) {\n      // Use requestAnimationFrame to ensure DOM has updated before scrolling\n      requestAnimationFrame(() => {\n        if (loggerRef.current) {\n          loggerRef.current.scrollTop = loggerRef.current.scrollHeight;\n        }\n      });\n    }\n  }, [logs]);\n\n  // Reset drag position when overlay position changes\n  useEffect(() => {\n    setDragPosition(null);\n  }, [overlayPosition]);\n\n  // Handle drag functionality for overlay mode\n  const handleMouseDown = useCallback((e: ReactMouseEvent<HTMLElement>) => {\n    if (displayMode !== 'overlay' || !wrapperRef.current) return;\n\n    const rect = wrapperRef.current.getBoundingClientRect();\n    setDragOffset({\n      x: e.clientX - rect.left,\n      y: e.clientY - rect.top,\n    });\n    // Use Date.now() as z-index to bring to front (works across all console instances)\n    setDragPosition({ x: rect.left, y: rect.top, zIndex: (Date.now() % 100000) + 1000 });\n    setIsDragging(true);\n  }, [displayMode]);\n\n  useEffect(() => {\n    if (!isDragging) return;\n\n    const handleMouseMove = (e: globalThis.MouseEvent) => {\n      const rect = wrapperRef.current?.getBoundingClientRect();\n      const width = rect?.width ?? 0;\n      const height = rect?.height ?? 0;\n\n      const x = Math.max(0, Math.min(e.clientX - dragOffset.x, window.innerWidth - width));\n      const y = Math.max(0, Math.min(e.clientY - dragOffset.y, window.innerHeight - height));\n\n      setDragPosition(prev => prev ? { ...prev, x, y } : null);\n    };\n\n    const handleMouseUp = () => {\n      setIsDragging(false);\n    };\n\n    document.addEventListener('mousemove', handleMouseMove);\n    document.addEventListener('mouseup', handleMouseUp);\n\n    return () => {\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n  }, [isDragging, dragOffset]);\n\n  const handleSubmit = () => {\n    if (!textInput.trim()) return;\n    sendMessage([createPartFromText(textInput)]);\n    setTextInput(\"\");\n    if (inputRef.current) {\n      inputRef.current.value = \"\";\n    }\n  };\n\n  // Compute if logger is actually visible (showLogger prop AND not minimized)\n  const isLoggerVisible = showLogger && overlayPosition !== \"minimized\";\n  const isCompact = overlayPosition === \"minimized\";\n\n  // Class names based on display mode\n  const wrapperClassName = cn(\n    \"console-wrapper\",\n    \"gemini-console-wrapper\",\n    displayMode === \"overlay\" ? `overlay-${overlayPosition}` : \"inline\",\n    { \"dragging\": isDragging }\n  );\n\n  // Custom position style when dragging\n  const wrapperStyle = dragPosition && displayMode === \"overlay\" ? {\n    position: 'fixed' as const,\n    left: dragPosition.x,\n    top: dragPosition.y,\n    right: 'auto',\n    bottom: 'auto',\n    transform: 'none',\n    zIndex: dragPosition.zIndex,\n  } : undefined;\n\n  // Handle typing indicator click - open in centered view\n  const handleTypingIndicatorClick = useCallback((e: ReactMouseEvent) => {\n    e.stopPropagation();\n    if (displayMode === \"overlay\" && overlayPosition === \"minimized\") {\n      setOverlayPosition(\"fullscreen\");\n    }\n    clearUnreadResponse();\n  }, [displayMode, overlayPosition, clearUnreadResponse]);\n\n  // Don't render if externally controlled and closed\n  if (!isOpen) {\n    return null;\n  }\n\n  return (\n    <div className={wrapperClassName} ref={wrapperRef} style={wrapperStyle}>\n      {/* Overlay Position Selector - only in overlay mode if enabled */}\n      {displayMode === \"overlay\" && enableOverlayPositionSelector && (\n        <div className=\"header-hover-area\">\n          <div className=\"overlay-controls\">\n            <button\n              className={cn({ active: overlayPosition === \"fullscreen\" })}\n              onClick={() => setOverlayPosition(\"fullscreen\")}\n              title=\"Fullscreen\"\n            >\n              <span className=\"material-symbols-outlined\">picture_in_picture_center</span>\n            </button>\n            <span className=\"side-panel-button\">\n              <button\n                className={cn({ active: overlayPosition === \"side\" })}\n                onClick={() => setOverlayPosition(\"side\")}\n                title=\"Dock to side\"\n              >\n                <span className=\"material-symbols-outlined\">dock_to_left</span>\n              </button>\n            </span>\n            <button\n              className={cn({ active: overlayPosition === \"minimized\" })}\n              onClick={() => setOverlayPosition(\"minimized\")}\n              title=\"Minimize\"\n            >\n              <span className=\"material-symbols-outlined\">collapse_content</span>\n            </button>\n            {onClose && (\n              <button\n                onClick={onClose}\n                title=\"Close\"\n              >\n                <span className=\"material-symbols-outlined\">close</span>\n              </button>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/* Main console container with background and border */}\n      <div\n        className=\"console gemini-console\"\n        onClick={() => {\n          if (isLoggerVisible) {\n            clearUnreadResponse();\n          }\n        }}\n      >\n        {/* Header - always visible, draggable in overlay mode */}\n        <header\n          className=\"console-header\"\n          onMouseDown={handleMouseDown}\n          style={{ cursor: displayMode === \"overlay\" ? 'grab' : undefined }}\n        >\n          <h2 className=\"agent-name\">{agentName}</h2>\n          <div className=\"header-spacer\" />\n          <button\n            ref={connectButtonRef}\n            className={cn(\"connect-button\", { connected })}\n            onClick={() => {\n              if (connected) {\n                endChat();\n              } else {\n                if (overlayPosition === \"minimized\") {\n                  setOverlayPosition(\"fullscreen\");\n                }\n                startChat();\n              }\n            }}\n          >\n            {connected ? \"Pause chat\" : \"Start chat\"}\n          </button>\n          <div\n            className=\"status-indicator-container typing-indicator-container\"\n            onClick={handleTypingIndicatorClick}\n            style={{ cursor: 'pointer' }}\n            title=\"Open console\"\n          >\n            <TypingIndicator active={isAwaitingResponse} hasNotification={hasUnreadResponse} />\n          </div>\n        </header>\n\n        {/* Logger Section - contains controls and logger, with disabled overlay when disconnected */}\n        {!isCompact && (\n          <div className={cn(\"logger-section\", { disabled: !connected })}>\n            {/* Logger Controls - conditional on enable props */}\n            {(enableLogStyleSelector || enableLogFilterSelector) && (\n              <div className=\"logger-controls\">\n                {enableLogFilterSelector && (\n                  <Select\n                    className=\"react-select\"\n                    classNamePrefix=\"react-select\"\n                    options={logFilterOptions}\n                    defaultValue={logFilterOptions.find((o) => o.value === initialLogFilter)}\n                    onChange={(e) => e && setLogFilter(e.value)}\n                  />\n                )}\n                {enableLogStyleSelector && (\n                  <Select\n                    className=\"react-select\"\n                    classNamePrefix=\"react-select\"\n                    options={logStyleOptions}\n                    defaultValue={logStyleOptions.find((o) => o.value === initialLogStyle)}\n                    onChange={(e) => e && setLogStyle(e.value)}\n                  />\n                )}\n              </div>\n            )}\n\n            {/* Logger Container - hidden when showLogger is false */}\n            {showLogger && (\n              <div className=\"logger-container\" ref={loggerRef}>\n                <GeminiLogger filter={logFilter} logStyle={logStyle} />\n              </div>\n            )}\n          </div>\n        )}\n\n        {/* Input Container - conditional on showInput prop */}\n        {showInput && (\n          <div\n            className={cn(\"input-container\", \"minimized-text-input\", {\n              disabled: !connected,\n              minimized: overlayPosition === \"minimized\",\n            })}\n          >\n            <textarea\n              id=\"gemini-console-input\"\n              ref={inputRef}\n              className=\"message-input\"\n              value={textInput}\n              onChange={(e) => setTextInput(e.target.value)}\n              onKeyDown={(e) => {\n                if (e.key === \"Enter\" && !e.shiftKey) {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  handleSubmit();\n                }\n              }}\n              placeholder={!connected ? \"Click 'Start chat' to start...\" : (placeholder || \"Type something...\")}\n              disabled={!connected}\n            />\n            <div className=\"input-settings\">\n              {!isCompact && (showApprovalSelector || showModelSelector) && (\n                <div className=\"model-settings\">\n                  {showApprovalSelector && (\n                    <Select\n                      className=\"react-select approval-mode-select\"\n                      classNamePrefix=\"react-select\"\n                      options={functionApprovalOptions}\n                      value={selectedApprovalMode}\n                      isSearchable={false}\n                      menuPlacement=\"top\"\n                      onChange={(e) => {\n                        if (e) {\n                          setSelectedApprovalMode(e);\n                          updateApprovalMode(e.value as \"manual\" | \"auto\");\n                        }\n                      }}\n                    />\n                  )}\n                  {showModelSelector && (\n                    <Select\n                      className=\"react-select model-select\"\n                      classNamePrefix=\"react-select\"\n                      options={modelOptions}\n                      value={selectedModel}\n                      isSearchable={false}\n                      menuPlacement=\"top\"\n                      onChange={(e) => {\n                        if (e) {\n                          setSelectedModel(e);\n                          updateModel(e.value);\n                        }\n                      }}\n                    />\n                  )}\n                </div>\n              )}\n              {overlayPosition !== \"minimized\" && <div className=\"input-spacer\" />}\n              <button\n                className={cn(\"action-button\", \"send-button\", {\n                  disabled: !connected || !textInput.trim(),\n                  ready: connected && textInput.trim(),\n                })}\n                onClick={handleSubmit}\n                disabled={!connected || !textInput.trim()}\n                title=\"Send\"\n              >\n                <span className=\"material-symbols-outlined filled\">east</span>\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default memo(GeminiCustomConsole);\n\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 16188,
      "order": 15
    },
    {
      "path": "gemini/components/GeminiDebug.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport GeminiCustomConsole from \"./GeminiCustomConsole\";\nimport { OverlayPosition } from \"../../types\";\n\nexport type GeminiDebugProps = {\n  agentName?: string;\n  initialOverlayPosition?: OverlayPosition;\n  isOpen?: boolean;\n  onClose?: () => void;\n  welcomeMessage?: string;\n  placeholder?: string;\n  initialAutoApprove?: boolean;\n  showApprovalSelector?: boolean;\n};\n\n/**\n * A debug overlay component for the Gemini API.\n * Pre-configured with:\n * - Overlay display mode with draggable positioning\n * - Full logger with filter and style selectors\n * - All input controls visible\n */\nfunction GeminiDebug({\n  agentName = \"Gemini Debug\",\n  initialOverlayPosition = \"side\",\n  isOpen = true,\n  onClose,\n  welcomeMessage,\n  placeholder,\n  initialAutoApprove = false,\n  showApprovalSelector = true,\n}: GeminiDebugProps) {\n  return (\n    <GeminiCustomConsole\n      agentName={agentName}\n      displayMode=\"overlay\"\n      initialOverlayPosition={initialOverlayPosition}\n      enableOverlayPositionSelector={true}\n      showInput={true}\n      showLogger={true}\n      enableLogStyleSelector={true}\n      enableLogFilterSelector={true}\n      initialLogStyle=\"chat\"\n      autoConnect={true}\n      isOpen={isOpen}\n      onClose={onClose}\n      welcomeMessage={welcomeMessage}\n      placeholder={placeholder}\n      initialAutoApprove={initialAutoApprove}\n      showApprovalSelector={showApprovalSelector}\n    />\n  );\n}\n\nexport default GeminiDebug;\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 2090,
      "order": 16
    },
    {
      "path": "gemini/components/GeminiLogger.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\n\nimport cn from \"classnames\";\nimport React, { memo, ReactNode } from \"react\";\nimport { useStore } from \"zustand\";\nimport { useGeminiAPIContext } from \"../contexts/GeminiAPIContext\";\nimport SyntaxHighlighter from \"react-syntax-highlighter\";\nimport { vs2015 } from \"react-syntax-highlighter/dist/cjs/styles/hljs\";\nimport {\n  GeminiLogEvent,\n} from \"../../types\";\nimport {\n  Part,\n  SendMessageParameters,\n  Tool,\n  ContentUnion,\n} from \"@google/genai\";\nimport { coreFilters, GeminiLoggerType } from \"../lib/gemini-log-filters\";\nimport { logStyleConfigs, DisplayOptions, ElementFilter, isVisible, isPartVisible, isAppLogVisible } from \"../../lib/log-style-config\";\nimport { LogStyle } from \"../../types\";\nimport { CollapsibleLogPart } from \"../../lib/CollapsibleLogPart\";\n\n// Custom theme based on vs2015 with background matching app colors\nconst customTheme = {\n  ...vs2015,\n  hljs: {\n    ...vs2015.hljs,\n    background: \"var(--Neutral-15)\",\n    scrollbarColor: \"var(--Neutral-30) var(--Neutral-15)\",\n  },\n};\n\nconst formatTime = (d: Date) => d.toLocaleTimeString().slice(0, -3);\n\n// Track which response IDs have had their functions executed/rejected\n// This persists across re-renders and is shared across all log instances\ntype ActionType = 'run' | 'reject';\nconst executedResponseActions = new Map<string, ActionType>();\n\nconst LogEntry = memo(\n  ({\n    log,\n    MessageComponent,\n    displayOptions,\n  }: {\n    log: GeminiLogEvent;\n    MessageComponent: ({\n      message,\n    }: {\n      message: GeminiLogEvent[\"message\"];\n    }) => ReactNode;\n    displayOptions: DisplayOptions;\n  }): React.ReactElement => {\n    return (\n      <li\n        className={cn(\n          `plain-log`,\n          `direction-${log.direction}`,\n          {\n            receive: log.direction === 'receive',\n            send: log.direction === 'send',\n          }\n        )}\n      >\n        {displayOptions.showTimestamp && <span className=\"timestamp\">{formatTime(log.date)}</span>}\n        {displayOptions.showLogType && <span className=\"source\">{log.type}</span>}\n        <div className=\"message\">\n          <MessageComponent message={log.message} />\n        </div>\n        {displayOptions.showCount && log.count && log.count > 1 && <span className=\"count\">{log.count}</span>}\n      </li>\n    );\n  }\n);\n\nconst PlainTextMessage = ({\n  message,\n}: {\n  message: GeminiLogEvent[\"message\"];\n}) => <span>{message as string}</span>;\n\ntype Message = { message: GeminiLogEvent[\"message\"]; filter?: GeminiLoggerType; visibleElements?: ElementFilter; defaultExpanded?: boolean };\n\nconst AnyMessage = ({ message }: Message\n\n) => (\n  <pre>{JSON.stringify(message, null, \"  \")}</pre>\n);\n\nfunction tryParseCodeExecutionResult(output: string) {\n  try {\n    const json = JSON.parse(output);\n    return JSON.stringify(json, null, \"  \");\n  } catch (e) {\n    return output;\n  }\n}\n\nfunction hasFunctionResponses(parts: Part[]): boolean {\n  return parts.some(part => part && part.functionResponse);\n}\n\n// Render components\n\nconst RenderPart = memo(({ part, defaultExpanded = true }: { part: Part; defaultExpanded?: boolean }) => {\n  if (part.thought) {\n    return (\n      <CollapsibleLogPart\n        title=\"Thinking\"\n        icon=\"short_text\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-thought\"\n      >\n        <p className=\"part-text\" style={{ color: \"var(--Neutral-60)\" }}>{part.text}</p>\n      </CollapsibleLogPart>\n    );\n  }\n  if (part.text && part.text.length) {\n    return <p className=\"part part-text\">{part.text}</p>;\n  }\n  if (part.executableCode) {\n    return (\n      <CollapsibleLogPart\n        title={`Run executable code: ${part.executableCode.language}`}\n        icon=\"play_arrow\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-executableCode\"\n      >\n        <SyntaxHighlighter\n          language={part.executableCode!.language!.toLowerCase()}\n          style={customTheme}\n        >\n          {part.executableCode!.code!}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (part.codeExecutionResult) {\n    return (\n      <CollapsibleLogPart\n        title={`Send code execution result: ${part.codeExecutionResult!.outcome}`}\n        icon=\"output\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-codeExecutionResult\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {tryParseCodeExecutionResult(part.codeExecutionResult!.output!)}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (part.functionCall) {\n    return (\n      <CollapsibleLogPart\n        title={`Call function: ${part.functionCall.name}`}\n        icon=\"terminal\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-functioncall\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(part.functionCall, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (part.functionResponse) {\n    return (\n      <CollapsibleLogPart\n        title={`Send function response: ${part.functionResponse!.name}`}\n        icon=\"output\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-functionresponse\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(part.functionResponse, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (part.inlineData) {\n    return (\n      <div className=\"part part-inlinedata\">\n        <h5>Send inline Data: {part.inlineData?.mimeType}</h5>\n      </div>\n    );\n  }\n  return <div className=\"part part-unknown\">&nbsp;</div>;\n});\n\nconst RenderSystemInstruction = memo(({ systemInstruction, defaultExpanded = true }: { systemInstruction: ContentUnion; defaultExpanded?: boolean }) => {\n  // Handle string type\n  if (typeof systemInstruction === \"string\") {\n    return (\n      <CollapsibleLogPart\n        title=\"System instruction\"\n        icon=\"menu\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-system-instruction\"\n      >\n        <p className=\"system-instruction-text\">{systemInstruction}</p>\n      </CollapsibleLogPart>\n    );\n  }\n\n  // Handle Part type\n  if (systemInstruction && typeof systemInstruction === \"object\" && \"text\" in systemInstruction) {\n    return (\n      <CollapsibleLogPart\n        title=\"System instruction\"\n        icon=\"menu\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-system-instruction\"\n      >\n        <RenderPart part={systemInstruction as Part} defaultExpanded={defaultExpanded} />\n      </CollapsibleLogPart>\n    );\n  }\n\n  // Handle Content type (has parts array)\n  if (systemInstruction && typeof systemInstruction === \"object\" && \"parts\" in systemInstruction) {\n    const content = systemInstruction as any;\n    return (\n      <CollapsibleLogPart\n        title=\"System instruction\"\n        icon=\"menu\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-system-instruction\"\n      >\n        {content.parts?.map((part: Part, j: number) => (\n          <RenderPart part={part} key={`system-instruction-part-${j}`} defaultExpanded={defaultExpanded} />\n        ))}\n      </CollapsibleLogPart>\n    );\n  }\n\n  // Handle PartUnion[] (array of parts)\n  if (Array.isArray(systemInstruction)) {\n    return (\n      <CollapsibleLogPart\n        title=\"System instruction\"\n        icon=\"menu\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-system-instruction\"\n      >\n        {systemInstruction.map((item: any, j: number) => {\n          if (typeof item === \"string\") {\n            return <RenderSystemInstruction systemInstruction={item} key={`system-instruction-part-${j}`} defaultExpanded={defaultExpanded} />;\n          } else {\n            return <RenderPart part={item as Part} key={`system-instruction-part-${j}`} defaultExpanded={defaultExpanded} />;\n          }\n        })}\n      </CollapsibleLogPart>\n    );\n  }\n\n  // Fallback for unknown types\n  return (\n    <CollapsibleLogPart\n      title=\"System instruction:\"\n      icon=\"info\"\n      defaultExpanded={defaultExpanded}\n      className=\"part-system-instruction\"\n    >\n      <SyntaxHighlighter language=\"json\" style={customTheme}>\n        {JSON.stringify(systemInstruction, null, \"  \")}\n      </SyntaxHighlighter>\n    </CollapsibleLogPart>\n  );\n});\n\nconst RenderTool = memo(({ tool, defaultExpanded = true }: { tool: Tool; defaultExpanded?: boolean }) => {\n  if (tool.functionDeclarations) {\n    return (\n      <CollapsibleLogPart\n        title=\"Declare functions\"\n        icon=\"code_blocks\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-functionDeclarations\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(tool.functionDeclarations, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (tool.googleSearch) {\n    return (\n      <CollapsibleLogPart\n        title=\"Google Search tool\"\n        icon=\"search\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-googleSearch\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(tool.googleSearch, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (tool.googleMaps) {\n    return (\n      <CollapsibleLogPart\n        title=\"Google Maps tool\"\n        icon=\"map\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-googleMaps\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(tool.googleMaps, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (tool.urlContext) {\n    return (\n      <CollapsibleLogPart\n        title=\"URL Context tool\"\n        icon=\"link\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-urlContext\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(tool.urlContext, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  if (tool.codeExecution) {\n    return (\n      <CollapsibleLogPart\n        title=\"Code Execution tool\"\n        icon=\"code\"\n        defaultExpanded={defaultExpanded}\n        className=\"part-codeExecution\"\n      >\n        <SyntaxHighlighter language=\"json\" style={customTheme}>\n          {JSON.stringify(tool.codeExecution, null, \"  \")}\n        </SyntaxHighlighter>\n      </CollapsibleLogPart>\n    );\n  }\n  return (\n    <CollapsibleLogPart\n      title=\"Tool\"\n      icon=\"build\"\n      defaultExpanded={defaultExpanded}\n      className=\"part-unknown-tool\"\n    >\n      <SyntaxHighlighter language=\"json\" style={customTheme}>\n        {JSON.stringify(tool, null, \"  \")}\n      </SyntaxHighlighter>\n    </CollapsibleLogPart>\n  );\n});\n\n// Client logs\n\nconst GenerateContentRequestLog = memo(({ message, filter, visibleElements = 'all', defaultExpanded = true }: Message) => {\n  const { model, contents, config } = message as any;\n\n  const parts: Part[] = [];\n\n  // Extract parts from contents array (may not exist for setModel/setConfig)\n  if (contents && Array.isArray(contents)) {\n    contents.forEach((content: any) => {\n      if (content.parts && Array.isArray(content.parts)) {\n        parts.push(...content.parts.filter((p: Part) => p != null));\n      }\n    });\n  }\n\n  // Filter parts based on visibleElements\n  const filteredParts = parts.filter(part => isPartVisible(part, visibleElements));\n\n  const tools: Tool[] = (config?.tools || []).filter((tool: any) =>\n    tool.functionDeclarations || tool.retrieval || tool.googleSearch ||\n    tool.googleMaps || tool.urlContext || tool.codeExecution\n  ) as Tool[];\n\n  const systemInstruction = config?.systemInstruction;\n  const showModel = model && isVisible('modelConfig', visibleElements);\n  const showSystemInstruction = systemInstruction && isVisible('systemInstruction', visibleElements);\n  const showTools = tools.length > 0 && !hasFunctionResponses(parts) && isVisible('tool', visibleElements);\n\n  return (\n    <div className=\"rich-log client-content user\">\n      <h4 className=\"role-user\">User</h4>\n      {showModel && (\n        <div className=\"part part-model\">\n          <h5>Config: model</h5>\n          <SyntaxHighlighter language=\"json\" style={customTheme}>\n            {JSON.stringify({ model }, null, \"  \")}\n          </SyntaxHighlighter>\n        </div>\n      )}\n      {showSystemInstruction && (\n        <RenderSystemInstruction systemInstruction={systemInstruction} defaultExpanded={defaultExpanded} />\n      )}\n      {showTools && tools.map((tool: Tool, j: number) => (\n        <RenderTool tool={tool} key={`tool-${j}`} defaultExpanded={defaultExpanded} />\n      ))}\n      {filteredParts.map((part: Part, j: number) => (\n        <RenderPart part={part} key={`message-part-${j}`} defaultExpanded={defaultExpanded} />\n      ))}\n    </div>\n  );\n});\n\nconst SendMessageRequestLog = memo(({ message, filter, visibleElements = 'all', defaultExpanded = true }: Message) => {\n  const { message: messagePartListUnion, config } = message as SendMessageParameters;\n\n  const parts: Part[] = [];\n\n  // Handle messagePartListUnion\n  if (typeof messagePartListUnion === \"string\") {\n    parts.push({ text: messagePartListUnion });\n  } else if (Array.isArray(messagePartListUnion)) {\n    for (const item of messagePartListUnion) {\n      if (typeof item === \"string\") {\n        parts.push({ text: item });\n      } else if (item) {\n        parts.push(item);\n      }\n    }\n  } else if (messagePartListUnion) {\n    parts.push(messagePartListUnion);\n  }\n\n  // Filter parts based on visibleElements\n  const filteredParts = parts.filter(part => isPartVisible(part, visibleElements));\n\n  const tools: Tool[] = (config?.tools || []).filter((tool: any) =>\n    tool.functionDeclarations || tool.retrieval || tool.googleSearch ||\n    tool.googleMaps || tool.urlContext || tool.codeExecution\n  ) as Tool[];\n\n  const systemInstruction = config?.systemInstruction;\n  const showSystemInstruction = systemInstruction && isVisible('systemInstruction', visibleElements);\n  const showTools = tools.length > 0 && !hasFunctionResponses(parts) && isVisible('tool', visibleElements);\n\n  return (\n    <div className=\"rich-log client-content user\">\n      <h4 className=\"role-user\">User</h4>\n      {showSystemInstruction && (\n        <RenderSystemInstruction systemInstruction={systemInstruction} defaultExpanded={defaultExpanded} />\n      )}\n      {showTools && tools.map((tool: Tool, j: number) => (\n        <RenderTool tool={tool} key={`tool-${j}`} defaultExpanded={defaultExpanded} />\n      ))}\n      {filteredParts.map((part: Part, j: number) => (\n        <RenderPart part={part} key={`message-part-${j}`} defaultExpanded={defaultExpanded} />\n      ))}\n    </div>\n  );\n});\n\n// App logs\n\nconst AppLog = memo(({ message, visibleElements = 'all', defaultExpanded = true }: Message) => {\n  const { model, config, placeholder, welcomeMessage, functionCalls, action } = message as any;\n  const { client } = useGeminiAPIContext();\n\n  const tools: Tool[] = (config?.tools || []).filter((tool: any) =>\n    tool.functionDeclarations || tool.retrieval || tool.googleSearch ||\n    tool.googleMaps || tool.urlContext || tool.codeExecution\n  ) as Tool[];\n\n  const systemInstruction = config?.systemInstruction;\n\n  // For functioncalls logs, determine if we should show buttons\n  // Only show active buttons if there's no action (wasn't auto-approved) and user hasn't acted yet\n  const responseId = functionCalls?.[0]?.id;\n  const executedAction = responseId ? executedResponseActions.get(responseId) : null;\n  const showActiveButtons = functionCalls && !action && !executedAction;\n\n  // Determine what's visible\n  const showModel = model && isVisible('modelConfig', visibleElements);\n  const showPlaceholder = placeholder && isVisible('placeholder', visibleElements);\n  const showWelcomeMessage = welcomeMessage && isVisible('welcomeMessage', visibleElements);\n  const showTools = tools.length > 0 && isVisible('tool', visibleElements);\n  const showFunctionCalls = functionCalls && isVisible('appFunctionReview', visibleElements);\n\n  // Return null if nothing to show\n  if (!showModel && !systemInstruction && !showPlaceholder && !showWelcomeMessage && !showTools && !showFunctionCalls) {\n    return null;\n  }\n\n  // Button handlers\n  const handleRunFunctionClick = () => {\n    if (responseId && functionCalls) {\n      client.emit(\"approvedfunctioncalls\", functionCalls);\n      executedResponseActions.set(responseId, 'run');\n    }\n  };\n\n  const handleRejectFunctionClick = () => {\n    if (responseId && functionCalls) {\n      client.emit(\"rejectedfunctioncalls\", functionCalls);\n      executedResponseActions.set(responseId, 'reject');\n    }\n  };\n\n  return (\n    <div className=\"rich-log client-content app\">\n      <h4 className=\"role-console\">Console</h4>\n      {model && isVisible('modelConfig', visibleElements) && (\n        <div className=\"part part-model\">\n          <h5>Set model</h5>\n          <SyntaxHighlighter language=\"json\" style={customTheme}>\n            {JSON.stringify({ model }, null, \"  \")}\n          </SyntaxHighlighter>\n        </div>\n      )}\n      {systemInstruction && (\n        <RenderSystemInstruction systemInstruction={systemInstruction} defaultExpanded={defaultExpanded} />\n      )}\n      {placeholder && isVisible('placeholder', visibleElements) && (\n        <div className=\"part part-placeholder\">\n          <h5>Placeholder text</h5>\n          <p className=\"placeholder-text\">{placeholder}</p>\n        </div>\n      )}\n      {welcomeMessage && (\n        <div className=\"part part-welcome-message\">\n          <p className=\"part-text\">{welcomeMessage}</p>\n        </div>\n      )}\n      {tools.map((tool: Tool, j: number) => (\n        <RenderTool tool={tool} key={`tool-${j}`} defaultExpanded={defaultExpanded} />\n      ))}\n      {functionCalls && !action && (\n        <div className=\"part part-function-status\">\n          <div className=\"function-buttons\">\n            <span>Run&nbsp;{functionCalls.length}&nbsp;{functionCalls.length === 1 ? 'function call' : 'function calls'}?</span>\n            <div className=\"button-group\">\n              <button\n                onClick={handleRunFunctionClick}\n                className={cn(\"run-function-button\", {\n                  clicked: executedAction === 'run'\n                })}\n                disabled={!showActiveButtons}\n              >\n                <span className=\"material-symbols-outlined\">check</span>\n                Approve\n              </button>\n              <button\n                onClick={handleRejectFunctionClick}\n                className={cn(\"reject-function-button\", {\n                  clicked: executedAction === 'reject'\n                })}\n                disabled={!showActiveButtons}\n              >\n                <span className=\"material-symbols-outlined\">close</span>\n                Reject\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      {functionCalls && action && (\n        <div className=\"part part-function-status\">\n          <div className=\"function-status-text\">\n            {action === 'auto-approve' && (\n              <><span className=\"material-symbols-outlined\">domain_verification</span> Auto-approved {functionCalls.length} {functionCalls.length === 1 ? 'function call' : 'function calls'}</>\n            )}\n            {action === 'run' && <><span className=\"material-symbols-outlined\">domain_verification</span> User approved {functionCalls.length} {functionCalls.length === 1 ? 'function call' : 'function calls'}</>}\n            {action === 'reject' && <><span className=\"material-symbols-outlined\">cancel_presentation</span> User rejected {functionCalls.length} {functionCalls.length === 1 ? 'function call' : 'function calls'}</>}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n});\n\n\n// Server logs\n\nconst ServerResponseLog = memo(({ message, defaultExpanded = true }: Message) => {\n  const serverResponse = message as any;\n\n  // Handle server responses with candidates structure\n  if (serverResponse.candidates && Array.isArray(serverResponse.candidates)) {\n    const parts: Part[] = [];\n\n    serverResponse.candidates.forEach((candidate: any) => {\n      if (candidate.content && candidate.content.parts) {\n        parts.push(...candidate.content.parts);\n      }\n    });\n\n    return (\n      <div className=\"rich-log server-content model\">\n        <h4 className=\"role-model\">Model</h4>\n        {parts.map((part: Part, j: number) => (\n          <RenderPart part={part} key={`server-part-${j}`} defaultExpanded={defaultExpanded} />\n        ))}\n      </div>\n    );\n  }\n\n  return <AnyMessage message={message} />;\n});\n\nexport type LoggerProps = {\n  filter: GeminiLoggerType;\n  logStyle?: LogStyle;\n};\n\nconst component = (log: GeminiLogEvent) => {\n  if (typeof log.message === \"string\") {\n    return PlainTextMessage;\n  }\n\n  switch (log.type) {\n    case 'app-set-model':\n    case 'app-set-config':\n    case 'app-set-placeholder':\n    case 'app-set-welcome':\n    case 'app-review-functions':\n    case 'app-approve-functions':\n    case 'app-reject-functions':\n      return AppLog;\n\n    case 'generate-content':\n      return log.direction === 'send'\n        ? GenerateContentRequestLog\n        : ServerResponseLog;\n\n    case 'send-message':\n      return log.direction === 'send'\n        ? SendMessageRequestLog\n        : ServerResponseLog;\n\n    case 'generate-content-stream':\n    case 'send-message-stream':\n      return log.direction === 'receive' ? ServerResponseLog : AnyMessage;\n\n    case 'function-call':\n    case 'function-response':\n      return ServerResponseLog;\n\n    default:\n      return AnyMessage;\n  }\n};\n\nexport default function GeminiLogger({ filter = \"all\", logStyle = \"console\" }: LoggerProps) {\n  const { loggerStore } = useGeminiAPIContext();\n  const logs = useStore(loggerStore, (state) => state.logs as GeminiLogEvent[]);\n\n  const filterFn = coreFilters[filter];\n  const styleConfig = logStyleConfigs[logStyle];\n  const { displayOptions } = styleConfig;\n\n  // Collapsible sections are expanded by default in console view, collapsed in chat view\n  const defaultExpanded = logStyle !== 'chat';\n\n  // For plain-text mode, always use AnyMessage\n  const getComponent = (log: GeminiLogEvent) => {\n    if (displayOptions.usePlainText) {\n      return AnyMessage;\n    }\n    return component(log);\n  };\n\n  // Filter out app logs that have no visible content\n  const isLogVisible = (log: GeminiLogEvent): boolean => {\n    const appLogTypes = ['app-set-model', 'app-set-config', 'app-set-placeholder', 'app-set-welcome', 'app-review-functions', 'app-approve-functions', 'app-reject-functions'];\n    if (appLogTypes.includes(log.type)) {\n      return isAppLogVisible(log.message, styleConfig.visibleElements);\n    }\n    return true;\n  };\n\n  return (\n    <div className=\"logger\">\n      <ul className=\"logger-list\">\n        {logs.filter(filterFn).filter(isLogVisible).map((log, key) => {\n          const MessageComponent = getComponent(log);\n          return (\n            <LogEntry\n              MessageComponent={(props) => <MessageComponent {...props} filter={filter} visibleElements={styleConfig.visibleElements} defaultExpanded={defaultExpanded} />}\n              log={log}\n              displayOptions={displayOptions}\n              key={key}\n            />\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 23947,
      "order": 17
    },
    {
      "path": "gemini/components/TypingIndicator.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport \"./typing-indicator.css\";\nimport c from \"classnames\";\n\nexport type TypingIndicatorProps = {\n  active: boolean;\n  hasNotification?: boolean;\n};\n\n/**\n * Simple typing indicator with 3 dots.\n * Shows bouncing animation when active, and optional notification dot.\n */\nexport default function TypingIndicator({ active, hasNotification }: TypingIndicatorProps) {\n  return (\n    <div className={c(\"typing-indicator\", { active })}>\n      <div className=\"dot\" />\n      <div className=\"dot\" />\n      <div className=\"dot\" />\n      {hasNotification && <div className=\"notification-dot\" />}\n    </div>\n  );\n}\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 1258,
      "order": 18
    },
    {
      "path": "gemini/components/gemini-custom-console.css",
      "content": "/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * GeminiConsole-specific styles.\n * Shared styles are in ../../shared/app.css\n */\n\n/* Hide the connect button */\n.gemini-console .connect-button {\n  display: none;\n}\n\n/* Core-specific model settings width */\n.gemini-console .model-settings {\n  min-width: 375px;\n}\n\n/* Core-specific minimized input adjustments */\n.gemini-console .input-container.minimized .message-input {\n  flex: 1;\n  min-height: 20px;\n  max-height: 20px;\n}\n\n/* ===== Function call approval - Gemini only for now ===== */\n.function-buttons {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex-wrap: wrap;\n}\n\n.function-buttons span {\n  white-space: nowrap;\n  font-weight: 500;\n  color: var(--Neutral-90);\n}\n\n.function-buttons .button-group {\n  display: flex;\n  gap: 12px;\n  margin-left: auto;\n}\n\n.function-buttons button {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 12px;\n  border-radius: 12px;\n  border: 1px solid transparent;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: all 0.2s ease;\n}\n\n.function-buttons button .material-symbols-outlined {\n  font-size: 18px;\n  color: inherit;\n}\n\n.function-buttons button:hover:not(:disabled) {\n  background-color: var(--Blue-800);\n  border-color: var(--Blue-500);\n  color: var(--Blue-500);\n}\n\n.function-buttons button.run-function-button {\n  background-color: var(--Blue-500);\n  color: white;\n}\n\n.function-buttons button.run-function-button.clicked {\n  background-color: var(--Blue-500);\n}\n\n.function-buttons button.reject-function-button {\n  background-color: var(--Neutral-20);\n  color: var(--Neutral-90);\n}\n\n.function-buttons button.reject-function-button.clicked {\n  background-color: var(--Neutral-30);\n}\n\n.function-buttons button:disabled {\n  background-color: var(--Neutral-20);\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n\n.function-buttons button:disabled.clicked {\n  background-color: var(--Blue-500);\n}\n\n.function-status-text {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  font-weight: 500;\n  color: var(--Neutral-70);\n}\n\n.function-status-text .material-symbols-outlined {\n  font-size: 18px;\n}",
      "role": "STYLE",
      "language": "css",
      "size": 2677,
      "order": 19
    },
    {
      "path": "gemini/components/gemini-mock-logs.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * this module is just mock data, intended to make it easier to develop and style the logger\n */\nimport type { GeminiLogEvent } from \"../../types\";\n\n// Mock data for Core API - using appropriate Core event types\nexport const mockLogs: GeminiLogEvent[] = [\n  {\n    date: new Date(),\n    type: \"send-message\",\n    direction: 'send',\n    message: {\n      message: [{ text: \"Hello, how are you?\" }],\n    },\n  },\n  {\n    date: new Date(),\n    type: \"send-message\",\n    direction: 'receive',\n    message: {\n      candidates: [\n        {\n          content: {\n            parts: [{ text: \"I'm doing well, thank you! How can I help you today?\" }],\n          },\n        },\n      ],\n    },\n  },\n  {\n    date: new Date(),\n    type: \"function-call\",\n    direction: 'receive',\n    message: {\n      candidates: [\n        {\n          content: {\n            parts: [\n              {\n                functionCall: {\n                  name: \"get_weather\",\n                  args: { location: \"San Francisco\" },\n                },\n              },\n            ],\n          },\n        },\n      ],\n    },\n  },\n  {\n    date: new Date(),\n    type: \"app-review-functions\",\n    direction: 'internal',\n    message: {\n      functionCalls: [\n        {\n          id: \"test-123\",\n          name: \"get_weather\",\n          args: { location: \"San Francisco\" },\n        },\n      ],\n    },\n  },\n  {\n    date: new Date(),\n    type: \"app-approve-functions\",\n    direction: 'internal',\n    message: {\n      functionCalls: [\n        {\n          id: \"test-123\",\n          name: \"get_weather\",\n          args: { location: \"San Francisco\" },\n        },\n      ],\n      action: \"run\",\n    },\n  },\n  {\n    date: new Date(),\n    type: \"function-response\",\n    direction: 'send',\n    message: {\n      candidates: [\n        {\n          content: {\n            parts: [\n              {\n                functionResponse: {\n                  name: \"get_weather\",\n                  response: { temperature: 72, conditions: \"sunny\" },\n                },\n              },\n            ],\n          },\n        },\n      ],\n    },\n  },\n];\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 2738,
      "order": 20
    },
    {
      "path": "gemini/components/typing-indicator.css",
      "content": "/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n.typing-indicator {\n  position: relative;\n  display: flex;\n  width: 24px;\n  height: 16px;\n  justify-content: space-evenly;\n  align-items: flex-end;\n}\n\n.typing-indicator .notification-dot {\n  position: absolute;\n  top: -15px;\n  right: -8px;\n  width: 10px;\n  height: 10px;\n  background-color: var(--Blue-500);\n  border-radius: 50%;\n}\n\n.typing-indicator .dot {\n  background-color: var(--Neutral-30);\n  border-radius: 1000px;\n  width: 4px;\n  height: 4px;\n  transition: background-color 0.3s ease;\n}\n\n.typing-indicator.active .dot {\n  background-color: var(--Neutral-80);\n  animation: bounce 1.4s infinite ease-in-out;\n}\n\n.typing-indicator.active .dot:nth-child(1) {\n  animation-delay: 0ms;\n}\n\n.typing-indicator.active .dot:nth-child(2) {\n  animation-delay: 150ms;\n}\n\n.typing-indicator.active .dot:nth-child(3) {\n  animation-delay: 300ms;\n}\n\n@keyframes bounce {\n  0%, 40%, 100% {\n    transform: translateY(0);\n  }\n  20% {\n    transform: translateY(-8px);\n  }\n}\n\n",
      "role": "STYLE",
      "language": "css",
      "size": 1553,
      "order": 21
    },
    {
      "path": "gemini/contexts/GeminiAPIContext.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createContext, FC, ReactNode, useContext } from \"react\";\nimport { useGeminiAPI, UseCoreAPIResults } from \"../hooks/use-gemini-api\";\n\nconst GeminiAPIContext = createContext<UseCoreAPIResults | undefined>(undefined);\n\nexport type GeminiAPIProviderProps = {\n  children: ReactNode;\n};\n\nexport const GeminiAPIProvider: FC<GeminiAPIProviderProps> = ({\n  children,\n}) => {\n  const coreAPI = useGeminiAPI();\n\n  return (\n    <GeminiAPIContext.Provider value={coreAPI}>\n      {children}\n    </GeminiAPIContext.Provider>\n  );\n};\n\nexport const useGeminiAPIContext = () => {\n  const context = useContext(GeminiAPIContext);\n  if (!context) {\n    throw new Error(\"useGeminiAPIContext must be used wihin a GeminiAPIProvider\");\n  }\n  return context;\n};\n",
      "role": "SERVICE",
      "language": "typescript",
      "size": 1400,
      "order": 22
    },
    {
      "path": "gemini/hooks/use-gemini-api.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { useMemo, useState, useEffect, useCallback } from \"react\";\nimport { GenerateContentConfig, GenerateContentResponse, Content, Part } from \"@google/genai\";\nimport { GenAIGeminiClient } from \"../lib/gemini-client\";\nimport { GeminiLogEvent } from \"../../types\";\nimport { createLoggerStore, LoggerStore } from \"../../lib/create-logger-store\";\n\n/**\n * API Key Configuration\n * \n * This hook supports two runtime environments:\n * \n * 1. Vite (local development)\n *    - Run with: npm run dev\n *    - Set your API key in .env file as: VITE_GEMINI_API_KEY=your_key_here\n * \n * 2. AI Studio (browser-based IDE)\n *    - Copy the src/ folder into AI Studio\n *    - AI Studio automatically provides the API key via process.env.API_KEY\n */\ndeclare const process: { env?: { API_KEY?: string } } | undefined;\n\nfunction getApiKey(): string {\n  // Try Vite environment first (local development)\n  if (typeof import.meta !== 'undefined' && import.meta.env?.VITE_GEMINI_API_KEY) {\n    return import.meta.env.VITE_GEMINI_API_KEY;\n  }\n\n  // Try AI Studio environment\n  if (typeof process !== 'undefined' && process?.env?.API_KEY) {\n    return process.env.API_KEY;\n  }\n\n  return '';\n}\n\nexport type UseCoreAPIResults = {\n  client: GenAIGeminiClient;\n  connected: boolean;\n  isAwaitingResponse: boolean;\n  hasUnreadResponse: boolean;\n  clearUnreadResponse: () => void;\n  generateContent: (contents: Content[]) => Promise<GenerateContentResponse>;\n  generateContentStream: (\n    contents: Content[],\n    onUpdate: (text: string) => void\n  ) => Promise<string | void>;\n  startChat: (history?: Content[]) => void;\n  endChat: () => void;\n  sendMessage: (message: Part[]) => Promise<GenerateContentResponse>;\n  sendMessageStream: (onUpdate: (text: string) => void, message: Part[]) => Promise<void>;\n  getHistory: () => Content[];\n  model: string;\n  setModel: (model: string) => void;\n  config: GenerateContentConfig;\n  setConfig: (config: GenerateContentConfig) => void;\n  placeholder: string;\n  setPlaceholder: (placeholder: string) => void;\n  welcomeMessage: string;\n  setWelcomeMessage: (message: string) => void;\n  autoApproveFunctionCalls: boolean;\n  setAutoApproveFunctionCalls: (autoApprove: boolean) => void;\n  functionCallingEnabled: boolean;\n  setFunctionCallingEnabled: (value: boolean) => void;\n  loggerStore: LoggerStore<GeminiLogEvent>;\n};\n\nexport function useGeminiAPI(): UseCoreAPIResults {\n  const apiKey = useMemo(() => {\n    const key = getApiKey();\n    if (!key) {\n      throw new Error(\n        \"API key not found. \" +\n        \"For local development, set VITE_GEMINI_API_KEY in your .env file. \" +\n        \"In AI Studio, the key is provided automatically.\"\n      );\n    }\n    return key;\n  }, []);\n\n  const client = useMemo(() => new GenAIGeminiClient({ apiKey }), [apiKey]);\n  const [model, setModel] = useState<string>(\"gemini-3-flash-preview\");\n  const [config, setConfig] = useState<GenerateContentConfig>({});\n  const [placeholder, setPlaceholder] = useState<string>(\"Type a message...\");\n  const [welcomeMessage, setWelcomeMessage] = useState<string>(\"\");\n  const [autoApproveFunctionCalls, setAutoApproveFunctionCalls] = useState<boolean>(false);\n  const [functionCallingEnabled, setFunctionCallingEnabled] = useState<boolean>(true);\n  const [connected, setConnected] = useState<boolean>(false);\n  const [isAwaitingResponse, setIsAwaitingResponse] = useState<boolean>(false);\n  const [hasUnreadResponse, setHasUnreadResponse] = useState<boolean>(false);\n\n  const clearUnreadResponse = useCallback(() => {\n    setHasUnreadResponse(false);\n  }, []);\n\n  // Create instance-specific logger store\n  const loggerStore = useMemo(() => createLoggerStore<GeminiLogEvent>(), []);\n  const logToStore = loggerStore.getState().log;\n\n  useEffect(() => {\n    const onLog = (log: GeminiLogEvent) => {\n      logToStore(log);\n    };\n    // Type assertions needed for AI Studio compatibility - its CDN-based environment\n    // doesn't properly resolve eventemitter3 types inherited by the client class\n    (client as any).on(\"log\", onLog);\n    return () => {\n      (client as any).off(\"log\", onLog);\n    };\n  }, [client, logToStore]);\n\n  useEffect(() => {\n    const onFunctionCalls = (functionCalls: any) => {\n      if (autoApproveFunctionCalls) {\n        // Re-emit as approvedfunctioncalls to trigger execution\n        client.emit(\"approvedfunctioncalls\", functionCalls);\n      } else {\n        // If auto-approve is off, trigger review in logger (no action yet)\n        logToStore({\n          date: new Date(),\n          direction: 'internal',\n          type: 'app-review-functions',\n          message: { functionCalls },\n        });\n      }\n    };\n\n    const onApprovedFunctionCalls = (functionCalls: any) => {\n      logToStore({\n        date: new Date(),\n        direction: 'internal',\n        type: 'app-approve-functions',\n        message: { functionCalls, action: autoApproveFunctionCalls ? 'auto-approve' : 'run' },\n      });\n    };\n\n    const onRejectedFunctionCalls = (functionCalls: any) => {\n      logToStore({\n        date: new Date(),\n        direction: 'internal',\n        type: 'app-reject-functions',\n        message: { functionCalls, action: 'reject' },\n      });\n    };\n\n    // Type assertions needed for AI Studio compatibility - see comment above\n    (client as any).on(\"functioncalls\", onFunctionCalls);\n    (client as any).on(\"approvedfunctioncalls\", onApprovedFunctionCalls);\n    (client as any).on(\"rejectedfunctioncalls\", onRejectedFunctionCalls);\n    return () => {\n      (client as any).off(\"functioncalls\", onFunctionCalls);\n      (client as any).off(\"approvedfunctioncalls\", onApprovedFunctionCalls);\n      (client as any).off(\"rejectedfunctioncalls\", onRejectedFunctionCalls);\n    };\n  }, [client, autoApproveFunctionCalls, logToStore]);\n\n  const getEffectiveConfig = useCallback(\n    (config: GenerateContentConfig) => {\n      let effectiveConfig = config;\n\n      // Remove tools if function calling is disabled\n      if (!functionCallingEnabled) {\n        const { tools, ...rest } = config;\n        effectiveConfig = rest;\n      }\n\n      // Always add thinking config\n      return {\n        ...effectiveConfig,\n        thinkingConfig: { ...effectiveConfig.thinkingConfig, includeThoughts: true },\n      };\n    },\n    [functionCallingEnabled]\n  );\n\n  const boundSetModel = useCallback((newModel: string) => {\n    setModel(newModel);\n    logToStore({\n      date: new Date(),\n      direction: 'internal',\n      type: 'app-set-model',\n      message: { model: newModel },\n    });\n  }, [logToStore]);\n\n  const boundSetConfig = useCallback((newConfig: GenerateContentConfig) => {\n    setConfig(newConfig);\n    logToStore({\n      date: new Date(),\n      direction: 'internal',\n      type: 'app-set-config',\n      message: { config: newConfig },\n    });\n  }, [logToStore]);\n\n  const boundSetPlaceholder = useCallback((newPlaceholder: string) => {\n    setPlaceholder(newPlaceholder);\n    logToStore({\n      date: new Date(),\n      direction: 'internal',\n      type: 'app-set-placeholder',\n      message: { placeholder: newPlaceholder },\n    });\n  }, [logToStore]);\n\n  const boundSetWelcomeMessage = useCallback((newWelcomeMessage: string) => {\n    setWelcomeMessage(newWelcomeMessage);\n    logToStore({\n      date: new Date(),\n      direction: 'internal',\n      type: 'app-set-welcome',\n      message: { welcomeMessage: newWelcomeMessage },\n    });\n  }, [logToStore]);\n\n  const boundGenerateContent = useCallback(\n    (contents: Content[]) => {\n      return client.generateContent(model, contents, getEffectiveConfig(config));\n    },\n    [client, model, config, getEffectiveConfig]\n  );\n  const boundGenerateContentStream = useCallback(\n    (contents: Content[], onUpdate: (text: string) => void) => {\n      return client.generateContentStream(onUpdate, model, contents, getEffectiveConfig(config));\n    },\n    [client, model, config, getEffectiveConfig]\n  );\n\n  const boundStartChat = useCallback(\n    (history?: Content[]) => {\n      // Not sending config as StartChat for now, sending with each message\n      client.startChat(model, undefined, history);\n      setConnected(true);\n    },\n    [client, model]\n  );\n\n  const boundEndChat = useCallback(\n    () => {\n      setConnected(false);\n    },\n    []\n  );\n\n  const boundSendMessage = useCallback(\n    async (message: Part[]) => {\n      setIsAwaitingResponse(true);\n      try {\n        const response = await client.sendMessage(message, getEffectiveConfig(config));\n        setHasUnreadResponse(true);\n        return response;\n      } finally {\n        setIsAwaitingResponse(false);\n      }\n    },\n    [client, config, getEffectiveConfig]\n  );\n\n  const boundSendMessageStream = useCallback(\n    async (onUpdate: (text: string) => void, message: Part[]) => {\n      setIsAwaitingResponse(true);\n      try {\n        await client.sendMessageStream(onUpdate, message, getEffectiveConfig(config));\n        setHasUnreadResponse(true);\n      } finally {\n        setIsAwaitingResponse(false);\n      }\n    },\n    [client, config, getEffectiveConfig]\n  );\n\n  const boundGetHistory = useCallback(\n    () => {\n      return client.getHistory();\n    },\n    [client]\n  );\n\n  return {\n    client,\n    connected,\n    isAwaitingResponse,\n    hasUnreadResponse,\n    clearUnreadResponse,\n    config,\n    setConfig: boundSetConfig,\n    model,\n    setModel: boundSetModel,\n    placeholder,\n    setPlaceholder: boundSetPlaceholder,\n    welcomeMessage,\n    setWelcomeMessage: boundSetWelcomeMessage,\n    autoApproveFunctionCalls,\n    setAutoApproveFunctionCalls,\n    functionCallingEnabled,\n    setFunctionCallingEnabled,\n    generateContent: boundGenerateContent,\n    generateContentStream: boundGenerateContentStream,\n    startChat: boundStartChat,\n    endChat: boundEndChat,\n    sendMessage: boundSendMessage,\n    sendMessageStream: boundSendMessageStream,\n    getHistory: boundGetHistory,\n    loggerStore,\n  };\n}\n",
      "role": "HOOK",
      "language": "typescript",
      "size": 10512,
      "order": 23
    },
    {
      "path": "gemini/lib/gemini-client.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GoogleGenAI, Part, Chat, Content, GenerateContentConfig, GenerateContentParameters, GenerateContentResponse, SendMessageParameters, CreateChatParameters, FunctionCall } from \"@google/genai\";\nimport { GeminiClientOptions, GeminiLogEvent, GeminiLogEventType, SharedAppLogEventType, LogDirection } from \"../../types\";\nimport { EventEmitter } from \"eventemitter3\";\n\n\n\nexport interface GeminiClientEventTypes {\n  // Emitted for logging events\n  log: (log: GeminiLogEvent) => void;\n  // Emitted when a function call is received. Use directly when approval is not required.\n  functioncalls: (functionCalls: (FunctionCall & { id: string })[]) => void;\n  // Emitted when a function call should be reviewed\n  reviewfunctioncalls: (functionCalls: (FunctionCall & { id: string })[]) => void;\n  // Emitted when a function call should be executed\n  approvedfunctioncalls: (functionCalls: (FunctionCall & { id: string })[]) => void;\n  // Emitted when a function call should be rejected\n  rejectedfunctioncalls: (functionCalls: (FunctionCall & { id: string })[]) => void;\n}\n\nexport class GenAIGeminiClient extends EventEmitter<GeminiClientEventTypes> {\n  private readonly genAI: GoogleGenAI;\n\n  private chat: Chat | null = null;\n\n  constructor(options: GeminiClientOptions) {\n    super();\n    this.genAI = new GoogleGenAI({ apiKey: options.apiKey });\n    this.sendMessage = this.sendMessage.bind(this);\n    this.sendMessageStream = this.sendMessageStream.bind(this);\n    this.startChat = this.startChat.bind(this);\n    this.getHistory = this.getHistory.bind(this);\n  }\n\n  protected log(params: {\n    type: GeminiLogEventType | SharedAppLogEventType;\n    direction: LogDirection;\n    message: any;\n  }) {\n    const logEvent: GeminiLogEvent = {\n      date: new Date(),\n      direction: params.direction,\n      type: params.type,\n      message: params.message,\n    };\n    // Type assertion needed for AI Studio compatibility - its CDN-based environment\n    // doesn't properly resolve eventemitter3 types inherited by the client class\n    (this as any).emit(\"log\", logEvent);\n  }\n\n  emitAnyFunctionCalls(response: GenerateContentResponse) {\n    const functionCalls = response.functionCalls;\n    if (!functionCalls || functionCalls.length === 0) {\n      return;\n    }\n\n    // Use response.responseId as the id for each function call\n    // If responseId is undefined, use the response object's timestamp as fallback\n    const id = response.responseId || `${Date.now()}`;\n    const functionCallsWithIds = functionCalls.map((fc) => {\n      return { ...fc, id };\n    });\n\n    // Uncomment to log the function calls to the logger\n    // We handle logging in approve/reject logic in the hook instead\n    // this.log(\"console.functioncalls\", { functionCalls: functionCallsWithIds });\n\n    (this as any).emit(\"functioncalls\", functionCallsWithIds);\n  }\n\n\n  async generateContent(model: string, contents: Content[], config?: GenerateContentConfig): Promise<GenerateContentResponse> {\n    const generateContentParameters: GenerateContentParameters = { model, contents, config: config };\n    console.log(\"client.generateContent\", generateContentParameters);\n    this.log({ type: 'generate-content', direction: 'send', message: generateContentParameters });\n    const result = await this.genAI.models.generateContent(generateContentParameters);\n    // This logs the result, including function calls, but doesn't actually call them\n    this.log({ type: 'generate-content', direction: 'receive', message: result });\n    // This emits an event for the called functions to be processed\n    this.emitAnyFunctionCalls(result);\n    return result;\n  }\n  async generateContentStream(\n    onUpdate: (text: string) => void,\n    model: string,\n    contents: Content[],\n    config?: GenerateContentConfig,\n  ): Promise<void> {\n    const generateContentParameters: GenerateContentParameters = { model, contents, config: config };\n    this.log({ type: 'generate-content-stream', direction: 'send', message: generateContentParameters });\n    const result = await this.genAI.models.generateContentStream(generateContentParameters);\n    let text = \"\";\n    let lastChunk: GenerateContentResponse | null = null;\n    for await (const chunk of result) {\n      this.log({ type: 'generate-content-stream', direction: 'receive', message: chunk });\n      const chunkText = chunk.text;\n      if (chunkText) {\n        text += chunkText;\n        onUpdate(text);\n        console.log(\"chunkText\", chunkText);\n      }\n      lastChunk = chunk;\n    }\n    // Trigger function calls after streaming is complete\n    if (lastChunk) {\n      this.emitAnyFunctionCalls(lastChunk);\n    }\n  }\n\n  startChat(model: string, config?: GenerateContentConfig, history?: Content[]): void {\n    const createChatParameters: CreateChatParameters = { model, config, history };\n    // this.log(\"client.startChat\", createChatParameters);\n    this.chat = this.genAI.chats.create(createChatParameters);\n  }\n\n  async sendMessage(message: Part[], config?: GenerateContentConfig): Promise<GenerateContentResponse> {\n    if (!this.chat) {\n      throw new Error(\"Chat not started.\");\n    }\n    const sendMessageParameters: SendMessageParameters = { message, config: config }\n    this.log({ type: 'send-message', direction: 'send', message: sendMessageParameters });\n    const result = await this.chat.sendMessage(sendMessageParameters);\n\n    // This logs the result, including function calls, but doesn't actually call them\n    this.log({ type: 'send-message', direction: 'receive', message: result });\n\n    // This emits an event for the called functions to be processed\n    this.emitAnyFunctionCalls(result);\n    return result;\n  }\n\n  async sendMessageStream(onUpdate: (text: string) => void, message: Part[], config?: GenerateContentConfig): Promise<void> {\n    if (!this.chat) {\n      throw new Error(\"Chat not started. Call startChat() first.\");\n    }\n    const sendMessageParameters: SendMessageParameters = { message, config: config }\n    this.log({ type: 'send-message-stream', direction: 'send', message: sendMessageParameters });\n    const stream = await this.chat.sendMessageStream(sendMessageParameters);\n    let text = \"\";\n    let lastChunk: GenerateContentResponse | null = null;\n    for await (const chunk of stream) {\n      this.log({ type: 'send-message-stream', direction: 'receive', message: chunk });\n      console.log(\"server.sendMessageStream\", chunk);\n      const chunkText = chunk.text;\n      if (chunkText) {\n        text += chunkText;\n        onUpdate(text);\n      }\n      lastChunk = chunk;\n    }\n    // Trigger function calls after streaming is complete\n    if (lastChunk) {\n      this.emitAnyFunctionCalls(lastChunk);\n    }\n  }\n\n  getHistory(): Content[] {\n    if (!this.chat) {\n      throw new Error(\"Chat not started. Call startChat() first.\");\n    }\n    const history = this.chat.getHistory();\n    return history;\n  }\n}\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 7521,
      "order": 24
    },
    {
      "path": "gemini/lib/gemini-log-filters.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { GeminiLogEvent, GeminiLogEventType, SharedAppLogEventType } from '../../types';\nimport { and, or, not, LogFilter } from '../../lib/log-filter-utils';\n\ntype CoreLogFilter = LogFilter<GeminiLogEvent>;\n\n// Basic filters\nconst byType = (type: GeminiLogEventType | SharedAppLogEventType): CoreLogFilter =>\n  (log) => log.type === type;\n\nconst isSend = (log: GeminiLogEvent) => log.direction === 'send';\nconst isReceive = (log: GeminiLogEvent) => log.direction === 'receive';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst isInternal = (log: GeminiLogEvent) => log.direction === 'internal';\n\n/**\n  * Composite filters\n  * Define any filters you want here and they will appear in the dropdown menu for the core logger\n  */\nexport const coreFilters = {\n  conversations: or(\n    and(\n      or(byType('send-message'), byType('generate-content')),\n      or(isSend, isReceive)\n    ),\n    byType('function-call'),\n    byType('app-set-welcome'),\n    byType('app-review-functions'),\n    byType('app-approve-functions'),\n    byType('app-reject-functions'),\n  ),\n\n  tools: or(\n    byType(\"function-call\"),\n    byType(\"function-response\"),\n    byType(\"app-approve-functions\"),\n    byType(\"app-reject-functions\"),\n    byType(\"app-review-functions\")\n  ),\n\n  all: () => true,\n} as const;\n\nexport type GeminiLoggerType = keyof (typeof coreFilters);\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 2012,
      "order": 25
    },
    {
      "path": "lib/CollapsibleLogPart.tsx",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from \"react\";\nimport cn from \"classnames\";\n\nexport type CollapsibleLogPartProps = {\n  title: string;\n  children: React.ReactNode;\n  defaultExpanded?: boolean;\n  className?: string;\n  icon?: string;\n};\n\n/**\n * A collapsible wrapper for verbose log content (thinking, function calls, etc.)\n * Shows a rotating triangle toggle that animates on expand/collapse.\n */\nexport const CollapsibleLogPart: React.FC<CollapsibleLogPartProps> = ({\n  title,\n  children,\n  defaultExpanded = true,\n  className,\n  icon,\n}) => {\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\n\n  return (\n    <div className={cn(\"part\", \"collapsible-part\", className, { expanded: isExpanded })}>\n      <h5\n        className=\"collapsible-header\"\n        onClick={() => setIsExpanded(!isExpanded)}\n      >\n        {icon && <span className=\"material-symbols-outlined header-icon\">{icon}</span>}\n        {title}\n        <span className=\"material-symbols-outlined toggle-icon\">\n          arrow_drop_down\n        </span>\n      </h5>\n      <div className=\"collapsible-content\">\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default CollapsibleLogPart;\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 1821,
      "order": 26
    },
    {
      "path": "lib/create-logger-store.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createStore } from \"zustand/vanilla\";\n\n/**\n * Base log event interface that both GeminiLogEvent and GeminiLiveLogEvent conform to.\n */\nexport interface BaseLogEvent {\n  date: Date;\n  direction: \"send\" | \"receive\" | \"internal\";\n  type: string;\n  message: any;\n  count?: number;\n}\n\n/**\n * Generic logger state for any log event type.\n */\nexport interface LoggerState<TLog extends BaseLogEvent> {\n  maxLogs: number;\n  logs: TLog[];\n  log: (logEvent: TLog) => void;\n  clearLogs: () => void;\n}\n\n/**\n * Generic logger store type for any log event type.\n */\nexport type LoggerStore<TLog extends BaseLogEvent> = ReturnType<typeof createLoggerStore<TLog>>;\n\n/**\n * Creates a generic logger store that can be used with any log event type.\n * Handles log deduplication (incrementing count for consecutive identical logs)\n * and maintains a maximum log limit.\n */\nexport function createLoggerStore<TLog extends BaseLogEvent>() {\n  return createStore<LoggerState<TLog>>((set, get) => ({\n    maxLogs: 100,\n    logs: [],\n    log: ({ date, type, direction, message }: TLog) => {\n      set((state) => {\n        const prevLog = state.logs[state.logs.length - 1];\n        if (prevLog && prevLog.type === type && prevLog.message === message) {\n          return {\n            logs: [\n              ...state.logs.slice(0, -1),\n              {\n                date,\n                direction,\n                type,\n                message,\n                count: prevLog.count ? prevLog.count + 1 : 1,\n              } as TLog,\n            ],\n          };\n        }\n        return {\n          logs: [\n            ...state.logs.slice(-(get().maxLogs - 1)),\n            {\n              date,\n              direction,\n              type,\n              message,\n            } as TLog,\n          ],\n        };\n      });\n    },\n\n    clearLogs: () => {\n      console.log(\"clear log\");\n      set({ logs: [] });\n    },\n  }));\n}\n",
      "role": "SERVICE",
      "language": "typescript",
      "size": 2559,
      "order": 27
    },
    {
      "path": "lib/log-filter-utils.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport type LogFilter<T> = (log: T) => boolean;\n\n// Combinator functions\nexport function and<T>(...filters: LogFilter<T>[]): LogFilter<T> {\n  return (log: T) => filters.every(f => f(log));\n}\n\nexport function or<T>(...filters: LogFilter<T>[]): LogFilter<T> {\n  return (log: T) => filters.some(f => f(log));\n}\n\nexport function not<T>(filter: LogFilter<T>): LogFilter<T> {\n  return (log: T) => !filter(log);\n}\n",
      "role": "UTIL",
      "language": "typescript",
      "size": 1062,
      "order": 28
    },
    {
      "path": "lib/log-style-config.ts",
      "content": "/**\n * @license\n * SPDX-License-Identifier: Apache-2.0\n*/\n\n/**\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Part } from \"@google/genai\";\nimport { LogStyle } from \"../types\";\n\n/**\n * All renderable element types in a log.\n * Includes Gemini API Part types AND config elements.\n */\nexport type ElementType =\n  // Config elements (not Part)\n  | 'modelConfig'\n  | 'systemInstruction'\n  | 'tool'\n  | 'placeholder'\n  | 'welcomeMessage'\n  // Part types (from Gemini API Part interface)\n  | 'text'\n  | 'thought'\n  | 'inlineData'\n  | 'fileData'\n  | 'functionCall'\n  | 'functionResponse'\n  | 'executableCode'\n  | 'codeExecutionResult'\n  // App elements (Core API)\n  | 'appFunctionReview'\n  | 'appFunctionStatus';\n\n/** A set of visible elements, or 'all' for no filtering */\nexport type ElementFilter = Set<ElementType> | 'all';\n\n/** Display options for log entries */\nexport type DisplayOptions = {\n  showTimestamp: boolean;\n  showRoleHeader: boolean;\n  showLogType: boolean;\n  showCount: boolean;\n  usePlainText: boolean;  // Use AnyMessage component for all logs\n};\n\n/** Configuration for a log style */\nexport type LogStyleConfig = {\n  visibleElements: ElementFilter;\n  displayOptions: DisplayOptions;\n};\n\n/** Style configurations indexed by LogStyle */\nexport const logStyleConfigs: Record<LogStyle, LogStyleConfig> = {\n  console: {\n    visibleElements: 'all',\n    displayOptions: {\n      showTimestamp: true,\n      showRoleHeader: true,\n      showLogType: true,\n      showCount: true,\n      usePlainText: false,\n    },\n  },\n  chat: {\n    visibleElements: new Set<ElementType>([\n      'text',\n      'functionCall',\n      'functionResponse',\n      'welcomeMessage',\n      'appFunctionReview',\n      'appFunctionStatus',\n      'systemInstruction',\n      'tool',\n    ]),\n    displayOptions: {\n      showTimestamp: false,\n      showRoleHeader: false,\n      showLogType: false,\n      showCount: false,\n      usePlainText: false,\n    },\n  },\n  plaintext: {\n    visibleElements: 'all',\n    displayOptions: {\n      showTimestamp: true,\n      showRoleHeader: true,\n      showLogType: true,\n      showCount: true,\n      usePlainText: true,  // Use AnyMessage for all logs\n    },\n  },\n};\n\n/** Check if an element type is visible */\nexport function isVisible(element: ElementType, filter: ElementFilter): boolean {\n  return filter === 'all' || filter.has(element);\n}\n\n/** Check if a Part should be visible based on its type */\nexport function isPartVisible(part: Part, filter: ElementFilter): boolean {\n  if (filter === 'all') return true;\n  if (part.thought === true) return filter.has('thought');\n  if (part.text !== undefined && part.text.length > 0) return filter.has('text');\n  if (part.functionCall !== undefined) return filter.has('functionCall');\n  if (part.functionResponse !== undefined) return filter.has('functionResponse');\n  if (part.executableCode !== undefined) return filter.has('executableCode');\n  if (part.codeExecutionResult !== undefined) return filter.has('codeExecutionResult');\n  if (part.inlineData !== undefined) return filter.has('inlineData');\n  if (part.fileData !== undefined) return filter.has('fileData');\n  return false;\n}\n\n/**\n * Check if an app log (app-set-model, app-set-config, etc.) has visible content.\n * Returns false if all showable content is null/undefined.\n */\nexport function isAppLogVisible(message: any, filter: ElementFilter): boolean {\n  if (!message || typeof message !== 'object') return false;\n\n  const { model, config, placeholder, welcomeMessage, functionCalls } = message;\n\n  // Check each field that could make the log visible\n  if (model && isVisible('modelConfig', filter)) return true;\n  if (config?.systemInstruction && isVisible('systemInstruction', filter)) return true;\n  if ((config?.tools?.length ?? 0) > 0 && isVisible('tool', filter)) return true;\n  if (placeholder && isVisible('placeholder', filter)) return true;\n  if (welcomeMessage && isVisible('welcomeMessage', filter)) return true;\n  if (functionCalls && isVisible('appFunctionReview', filter)) return true;\n\n  return false;\n}\n",
      "role": "COMPONENT",
      "language": "typescript",
      "size": 4593,
      "order": 29
    },
    {
      "path": "styles/console.css",
      "content": "/**\n * Shared console styles\n * Move console-related CSS from App.css here\n */\n\n\n/* ===== Console Wrapper ===== */\n.console-wrapper {\n  display: flex;\n  flex-direction: column;\n  --dock-padding: 24px;\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.console-wrapper.overlay-side,\n.console-wrapper.overlay-bottom,\n.console-wrapper.overlay-fullscreen,\n.console-wrapper.overlay-minimized {\n  position: fixed;\n  z-index: 1000;\n}\n\n.console-wrapper.overlay-side {\n  top: var(--dock-padding);\n  right: var(--dock-padding);\n  width: 500px;\n  height: calc(100vh - var(--dock-padding) * 2);\n  max-width: calc(100vw - 32px);\n  min-width: 500px;\n}\n\n.console-wrapper.overlay-bottom {\n  left: 50%;\n  transform: translateX(-50%);\n  bottom: var(--dock-padding);\n  width: calc(100% - var(--dock-padding) * 2);\n  height: 50vh;\n}\n\n.console-wrapper.overlay-fullscreen {\n  top: 24px;\n  left: 50%;\n  transform: translateX(-50%);\n  width: calc(100vw - 48px);\n  height: calc(100vh - 48px);\n}\n\n.console-wrapper.overlay-minimized {\n  bottom: 24px;\n  right: 24px;\n  max-width: 500px;\n  height: auto;\n}\n\n.console-wrapper.inline {\n  position: relative;\n  width: 100%;\n  height: 100%;\n}\n\n.console-wrapper.inline .console {\n  border-radius: 0;\n}\n\n/* ===== Console ===== */\n.console {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  background: var(--Neutral-5);\n  border: 1px solid var(--Neutral-30);\n  border-radius: 24px;\n  overflow: hidden;\n  font-family: var(--font-family);\n  font-size: 13px;\n  color: var(--Neutral-90);\n}\n\n/* ===== Overlay Controls ===== */\n.console-wrapper .header-hover-area {\n  display: flex;\n  justify-content: flex-end;\n  padding: 8px 0px;\n  flex-shrink: 0;\n}\n\n.console-wrapper .overlay-controls {\n  display: flex;\n  gap: 4px;\n  opacity: 1;\n  pointer-events: auto;\n  background: var(--Neutral-20);\n  border-radius: 20px;\n  padding: 4px;\n}\n\n.console-wrapper .overlay-controls button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  border: none;\n  background: var(--Neutral-20);\n  color: var(--Neutral-60);\n  border-radius: 20px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n}\n\n.console-wrapper .overlay-controls button:hover {\n  background: transparent;\n  border: 1px solid var(--Neutral-20);\n}\n\n.console-wrapper .overlay-controls button.active {\n  background: var(--Blue-800);\n  color: var(--Blue-500);\n}\n\n.console-wrapper .overlay-controls button .material-symbols-outlined {\n  font-size: 22px;\n}\n\n/* ===== Header ===== */\n.console .console-header {\n  display: flex;\n  align-items: center;\n  padding: 20px 20px 20px 25px;\n  gap: 12px;\n  background: var(--Neutral-5);\n  border-bottom: 1px solid var(--Neutral-20);\n  flex-shrink: 0;\n  user-select: none;\n}\n\n.console .agent-name {\n  margin: 0;\n  color: var(--Neutral-90);\n  font-family: \"Google Sans\", sans-serif;\n  font-size: 21px;\n  font-weight: 500;\n  line-height: 28px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.console .header-spacer {\n  flex: 1;\n  min-width: 0;\n}\n\n.console .status-indicator-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  min-width: 40px;\n  min-height: 40px;\n  border-radius: 14px;\n  background: var(--Neutral-5);\n  border: 1px solid var(--Neutral-20);\n}\n\n.console .connect-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 40px;\n  padding: 0 20px;\n  border: 1px solid transparent;\n  background: var(--Blue-500);\n  border-radius: 20px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n  font-size: 16px;\n  color: white;\n  font-weight: 700;\n  white-space: nowrap;\n  position: relative;\n  z-index: 1;\n}\n\n/* Pulse animation for disconnected state */\n@keyframes connect-button-pulse {\n  0% {\n    transform: scale(1);\n    opacity: 0.8;\n  }\n  50% {\n    transform: scale(1.15);\n    opacity: 0;\n  }\n  100% {\n    transform: scale(1);\n    opacity: 0;\n  }\n}\n\n.console .connect-button:not(.connected)::before {\n  content: \"\";\n  position: absolute;\n  z-index: -1;\n  top: -4px;\n  left: -2px;\n  right: -2px;\n  bottom: -4px;\n  background: var(--Blue-500);\n  border-radius: 24px;\n  animation: connect-button-pulse 2s ease-out infinite;\n}\n\n.console .connect-button:hover {\n  background: transparent;\n  border: 1px solid var(--Neutral-20);\n  color: var(--Neutral-60);\n}\n\n.console .connect-button:hover::before {\n  display: none;\n}\n\n.console .connect-button.connected {\n  background: var(--Blue-800);\n  color: var(--Blue-500);\n}\n\n.console .connect-button.connected:hover {\n  border: 1px solid var(--Blue-500);\n}\n\n/* ===== Logger Controls ===== */\n.console .logger-controls {\n  display: flex;\n  gap: 8px;\n  padding: 12px 25px;\n  background: var(--Neutral-5);\n  flex-shrink: 0;\n}\n\n.console .logger-controls .react-select {\n  min-width: 0;\n}\n\n/* ===== Logger Section ===== */\n.console .logger-section {\n  display: flex;\n  flex-direction: column;\n  flex: 1;\n  min-height: 0;\n  position: relative;\n}\n\n.console .logger-section.disabled::after {\n  content: \"\";\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: var(--Neutral-5);\n  opacity: 0.6;\n  pointer-events: none;\n  z-index: 1;\n}\n\n/* ===== Logger Container ===== */\n.console .logger-container {\n  flex: 1;\n  overflow-y: auto;\n  min-height: 0;\n  padding: 8px 0;\n  width: 100%;\n}\n\n.console .logger-container::-webkit-scrollbar {\n  width: 8px;\n}\n\n.console .logger-container::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.console .logger-container::-webkit-scrollbar-thumb {\n  background: var(--Neutral-30);\n  border-radius: 4px;\n}\n\n.console .logger-container::-webkit-scrollbar-thumb:hover {\n  background: var(--Neutral-40);\n}\n\n/* ===== Input Container ===== */\n.console .input-container {\n  display: flex;\n  flex-direction: column;\n  margin: 12px;\n  padding: 16px 16px;\n  gap: 12px;\n  background: var(--Neutral-15);\n  border: 1px solid var(--Neutral-30);\n  border-radius: 16px;\n  flex-shrink: 0;\n}\n\n.console .input-container.disabled .message-input {\n  opacity: 0.5;\n  pointer-events: none;\n}\n\n.console .input-container.disabled .message-input::placeholder {\n  color: white;\n}\n\n.console .message-input {\n  width: 100%;\n  min-height: 22px;\n  max-height: 100px;\n  padding: 0;\n  border: none;\n  background: transparent;\n  color: var(--Neutral-90);\n  font-family: inherit;\n  font-size: 14px;\n  resize: none;\n  outline: none;\n  box-sizing: border-box;\n  field-sizing: content;\n  overflow-y: hidden;\n}\n\n.console .message-input:focus {\n  outline: none;\n}\n\n.console .message-input::placeholder {\n  color: var(--Neutral-50);\n}\n\n.console .input-settings {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.console .model-settings {\n  display: flex;\n  gap: 8px;\n  flex: 1;\n  min-width: 200px;\n  max-width: 400px;\n}\n\n.console .model-settings .react-select {\n  flex: 1;\n  min-width: 0;\n}\n\n.console .input-spacer {\n  flex: 1;\n  min-width: 0;\n}\n\n/* ===== Action Buttons ===== */\n.console .action-button {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  border: 1px solid transparent;\n  background: var(--Neutral-20);\n  color: var(--Neutral-60);\n  border-radius: 14px;\n  cursor: pointer;\n  transition: all 0.2s ease-in-out;\n}\n\n.console .action-button:focus {\n  outline: none;\n}\n\n.console .action-button:hover {\n  background: transparent;\n  border: 1px solid var(--Neutral-20);\n}\n\n.console .action-button.active {\n  background: var(--Blue-800);\n  color: var(--Blue-500);\n}\n\n.console .action-button.active:hover {\n  border: 1px solid var(--Blue-500);\n}\n\n.console .action-button.disabled,\n.console .action-button:disabled {\n  background: transparent;\n  border: 1px solid var(--Neutral-30);\n  color: var(--Neutral-30);\n  cursor: not-allowed;\n}\n\n.console .action-button .material-symbols-outlined {\n  font-size: 20px;\n}\n\n.console .send-button.ready {\n  background: var(--Blue-500);\n  color: white;\n  border-color: transparent;\n}\n\n.console .send-button.ready:hover {\n  background: var(--Blue-400);\n}\n\n/* ===== Bottom Console Override ===== */\n.console-wrapper.overlay-bottom .console-header {\n  padding: 15px 20px;\n}\n\n/* ===== Minimized Console Override ===== */\n.console-wrapper.overlay-minimized .logger-container {\n  display: none;\n}\n\n.console-wrapper.overlay-minimized .logger-controls {\n  display: none;\n}\n\n.console-wrapper.overlay-minimized .console-header {\n  padding: 10px 14px;\n}\n\n.console .input-container.minimized {\n  flex-direction: row;\n  padding: 10px 12px;\n  margin: 0 12px 12px 12px;\n  gap: 8px;\n}\n\n.console .input-container.minimized .input-settings {\n  flex-shrink: 0;\n}\n\n/* ===== React Select Dropdowns ===== */\n.react-select {\n  color: var(--Neutral-90);\n  height: 30px;\n}\n\n.react-select .react-select__control {\n  outline: none;\n  background: var(--Neutral-15);\n  color: var(--Neutral-90);\n  min-height: 33px;\n  max-height: 33px;\n  border: 0;\n}\n\n.react-select .react-select__indicator-separator {\n  display: none;\n}\n\n.react-select .react-select__single-value {\n  color: var(--Neutral-90);\n}\n\n.react-select .react-select__menu {\n  background: var(--Neutral-20);\n  color: var(--Neutral-90);\n}\n\n.react-select .react-select__option--is-focused {\n  background: var(--Neutral-30);\n}\n\n.react-select .react-select__option--is-selected {\n  background: var(--Neutral-20);\n}\n\n.model-settings .react-select .react-select__dropdown-indicator {\n  transform: rotate(180deg);\n}\n\n.react-select--is-disabled .react-select__control {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.react-select--is-disabled .react-select__single-value {\n  color: var(--Neutral-60);\n}\n\n/* ===== Logger ===== */\n.logger {\n  color: var(--Neutral-50);\n  width: 100%;\n  max-width: 100%;\n  display: block;\n}\n\n.logger .logger-list {\n  padding: 0 0px 0 25px;\n  overflow-x: hidden;\n  width: calc(100% - 45px);\n  margin-bottom: 0;\n}\n\n.logger .user h4 {\n  color: var(--Green-500);\n}\n\n.logger .model h4 {\n  color: var(--Blue-500);\n}\n\n.logger .rich-log {\n  display: block;\n  justify-content: center;\n  gap: 4px;\n  width: 100%;\n}\n\n.logger .rich-log pre {\n  overflow-x: auto;\n}\n\n.logger .rich-log h4 {\n  font-size: 14px;\n  text-transform: uppercase;\n  padding: 8px 0;\n  margin: 0;\n}\n\n.logger .rich-log h5 {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 500;\n}\n\n.logger .rich-log .part>p {\n  margin: 4px;\n}\n\n.logger .rich-log .role-user {\n  color: var(--Green-500);\n}\n\n.logger .rich-log .role-model {\n  color: var(--Blue-500);\n}\n\n.logger .rich-log .part {\n  background: var(--Neutral-15);\n  padding: 14px;\n  margin: 6px 0;\n  color: var(--Neutral-90);\n  border-radius: 8px;\n}\n\n.logger .rich-log .part>* {\n  max-height: 200px;\n  white-space: pre-wrap;\n  word-wrap: break-word;\n}\n\n/* Collapsible Part Toggle */\n.logger .collapsible-part .collapsible-header {\n  display: flex;\n  align-items: center;\n  gap: 2px;\n  cursor: pointer;\n  user-select: none;\n  color: var(--Neutral-70);\n}\n\n.logger .collapsible-part .collapsible-header .header-icon {\n  font-size: 18px;\n  margin-right: 6px;\n}\n\n.logger .collapsible-part .collapsible-header .toggle-icon {\n  transition: transform 0.2s ease;\n  color: var(--Neutral-60);\n  transform: rotate(0deg);\n}\n\n.logger .collapsible-part.expanded .collapsible-header .toggle-icon {\n  transform: rotate(-180deg);\n}\n\n.logger .collapsible-part .collapsible-content {\n  display: none;\n  overflow-y: auto;\n  scrollbar-color: var(--Neutral-30) var(--Neutral-15);\n}\n\n.logger .collapsible-part.expanded .collapsible-content {\n  display: block;\n  margin-top: 8px;\n  padding-top: 8px;\n  border-top: 1px solid var(--Neutral-20);\n}\n\n/* Disable container scrolling when pre handles its own scrolling */\n.logger .collapsible-part .collapsible-content:has(pre) {\n  overflow-y: visible;\n}\n\n.logger .collapsible-part .collapsible-content pre {\n  max-height: 180px;\n  overflow: auto;\n}\n\n.logger .plain-log>* {\n  padding-right: 4px;\n}\n\n.logger .inline-code:not(:last-child) {\n  font-style: italic;\n}\n\n.logger .inline-code:not(:last-child)::after {\n  content: \", \";\n}\n\n.logger li {\n  display: block;\n  padding: 10px 0;\n  color: var(--Neutral-50, #707577);\n  font-family: \"Space Mono\";\n  font-size: 14px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: normal;\n}\n\n.logger li .timestamp {\n  width: 70px;\n  flex-grow: 0;\n  flex-shrink: 0;\n  color: var(--Neutral-50);\n}\n\n.logger li .source {\n  flex-shrink: 0;\n  font-weight: bold;\n}\n\n.logger li.source-server,\n.logger li.receive,\n.logger li.tool-call {\n  color: var(--Blue-500);\n}\n\n.logger li.source-client,\n.logger li.send:not(.source-server) {\n  color: var(--Green-500);\n}\n\n.logger li .count {\n  background-color: var(--Neutral-5);\n  font-size: x-small;\n  padding: 0.3em 0.5em;\n  line-height: 1em;\n  vertical-align: middle;\n  border-radius: 8px;\n  color: var(--Blue-500);\n}\n\n.logger li .message {\n  flex-grow: 1;\n  color: var(--Neutral-50);\n}\n\n/* ===== Mobile Responsive Styles ===== */\n@media (max-width: 600px) {\n  .console-wrapper {\n    --dock-padding: 8px;\n    max-width: 100vw;\n    box-sizing: border-box;\n  }\n\n  .console-wrapper.overlay-side,\n  .console-wrapper.overlay-fullscreen {\n    top: var(--dock-padding);\n    left: var(--dock-padding);\n    right: var(--dock-padding);\n    width: calc(100vw - var(--dock-padding) * 2);\n    max-width: calc(100vw - var(--dock-padding) * 2);\n    min-width: unset;\n    height: calc(100vh - var(--dock-padding) * 2);\n    transform: none;\n  }\n\n  .console-wrapper.overlay-minimized {\n    right: 8px;\n    bottom: 8px;\n    max-width: calc(100vw - 16px);\n  }\n\n  .console {\n    border-radius: 16px;\n  }\n\n  .console .console-header {\n    padding: 12px 12px 12px 16px;\n    gap: 8px;\n  }\n\n  .console .agent-name {\n    font-size: 18px;\n  }\n\n  .console .logger-controls {\n    padding: 8px 12px;\n  }\n\n  .logger .logger-list {\n    padding: 0 0 0 12px;\n    width: calc(100% - 24px);\n  }\n\n  .console .input-container {\n    margin: 8px;\n    padding: 12px;\n    gap: 8px;\n  }\n\n  /* Hide side panel dock button on mobile */\n  .side-panel-button,\n  .console .model-settings {\n    display: none;\n  }\n}\n\n",
      "role": "STYLE",
      "language": "css",
      "size": 13948,
      "order": 30
    }
  ],
  "frontend_deps": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "@google/genai": "^1.30.0",
    "zustand": "^5.0.8",
    "classnames": "^2.5.1",
    "eventemitter3": "^5.0.1",
    "react-select": "^5.10.2",
    "react-syntax-highlighter": "^16.1.0",
    "lodash": "^4.17.21",
    "three": "^0.182.0",
    "tone": "^15.1.22"
  },
  "backend_deps": {},
  "created_at": "1772068059",
  "version": 1,
  "category": "ai-demo"
}